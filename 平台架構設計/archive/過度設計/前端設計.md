# å‰ç«¯è¨­è¨ˆ (å­¸ç”Ÿç«¯ + æ•™å¸«ç«¯)

> **ç›®æ¨™**: ç°¡æ½”æ˜“ç”¨çš„å­¸ç”Ÿå­¸ç¿’ä»‹é¢ + é«˜æ•ˆçš„æ•™å¸«ç®¡ç†å¾Œå°
>
> **æŠ€è¡“**: React + TypeScript + TailwindCSS + shadcn/ui

---

## ğŸ¯ è¨­è¨ˆåŸå‰‡

### å­¸ç”Ÿç«¯ (Student Portal)

| åŸå‰‡ | èªªæ˜ |
|------|------|
| **ç°¡æ½”ç›´è§€** | å°å­¸ç”Ÿèƒ½ç¨ç«‹æ“ä½œ,ç„¡éœ€èªªæ˜ |
| **å¤§æŒ‰éˆ• + å¤§å­—** | è€ƒæ…®å¹´å¹¼å­¸ç”Ÿè¦–åŠ› |
| **å³æ™‚å›é¥‹** | ä¸Šå‚³æˆåŠŸ/è©•åˆ†å®Œæˆç«‹å³é¡¯ç¤º |
| **éŠæˆ²åŒ–** | é€²åº¦æ¢ã€æˆå°±å¾½ç« ã€é¼“å‹µèª |

### æ•™å¸«ç«¯ (Teacher Portal)

| åŸå‰‡ | èªªæ˜ |
|------|------|
| **è³‡è¨Šå¯†åº¦é«˜** | ä¸€é é¡¯ç¤ºå¤šå€‹å­¸ç”Ÿç‹€æ…‹ |
| **æ‰¹é‡æ“ä½œ** | ä¸€éµè©•åˆ†ã€æ‰¹é‡å›é¥‹ |
| **æ•¸æ“šè¦–è¦ºåŒ–** | ç­ç´šå¹³å‡åˆ†ã€å®Œæˆç‡åœ–è¡¨ |
| **å¿«é€Ÿå°èˆª** | è·¨ç­ç´šã€è·¨ä½œæ¥­å¿«é€Ÿåˆ‡æ› |

---

## 1ï¸âƒ£ æŠ€è¡“æ£§

```typescript
// package.json
{
  "dependencies": {
    "react": "^18.2.0",
    "react-router-dom": "^6.20.0",
    "typescript": "^5.3.0",
    "tailwindcss": "^3.3.0",
    "@tanstack/react-query": "^5.0.0", // è³‡æ–™ç²å–
    "axios": "^1.6.0",
    "zustand": "^4.4.0", // ç‹€æ…‹ç®¡ç†
    "@radix-ui/react-*": "latest", // ç„¡éšœç¤™ UI çµ„ä»¶ (via shadcn/ui)
    "lucide-react": "^0.300.0", // åœ–æ¨™
    "recharts": "^2.10.0", // åœ–è¡¨
    "react-hook-form": "^7.49.0", // è¡¨å–®
    "zod": "^3.22.0" // è¡¨å–®é©—è­‰
  },
  "devDependencies": {
    "vite": "^5.0.0",
    "vitest": "^1.0.0",
    "playwright": "^1.40.0"
  }
}
```

---

## 2ï¸âƒ£ å­¸ç”Ÿç«¯è¨­è¨ˆ

### 2.1 é é¢çµæ§‹

```
/student
  â”œâ”€â”€ /dashboard (é¦–é : èª²ç¨‹åˆ—è¡¨ + ä½œæ¥­åˆ—è¡¨)
  â”œâ”€â”€ /lesson/:lessonId (èª²ç¨‹è©³æƒ…: èª²æ–‡ + ç”Ÿå­— + æœ—è®€)
  â”œâ”€â”€ /assignment/:assignmentId (ä½œæ¥­è©³æƒ…: æäº¤éŸ³æª”)
  â”œâ”€â”€ /submissions (æˆ‘çš„æäº¤è¨˜éŒ„)
  â”œâ”€â”€ /progress (å­¸ç¿’é€²åº¦)
  â””â”€â”€ /achievements (æˆ‘çš„æˆå°±)
```

---

### 2.2 Dashboard (å­¸ç”Ÿé¦–é )

```tsx
// src/pages/student/Dashboard.tsx
import { useQuery } from '@tanstack/react-query';
import { Card } from '@/components/ui/card';
import { Progress } from '@/components/ui/progress';
import { BookOpen, FileText, Trophy } from 'lucide-react';

export function StudentDashboard() {
  const { data: student } = useQuery({
    queryKey: ['student', 'me'],
    queryFn: () => api.get('/student/me'),
  });

  const { data: assignments } = useQuery({
    queryKey: ['assignments', 'pending'],
    queryFn: () => api.get('/student/assignments/pending'),
  });

  return (
    <div className="container mx-auto p-6 max-w-4xl">
      {/* æ­¡è¿æ¨™é¡Œ */}
      <div className="mb-8">
        <h1 className="text-3xl font-bold">ä½ å¥½,{student.name}!</h1>
        <p className="text-gray-600 mt-2">ä»Šå¤©è¦ç¹¼çºŒåŠªåŠ›å­¸ç¿’å–” ğŸ“š</p>
      </div>

      {/* å­¸ç¿’é€²åº¦å¡ç‰‡ */}
      <Card className="p-6 mb-6">
        <div className="flex items-center justify-between mb-4">
          <h2 className="text-xl font-semibold flex items-center gap-2">
            <BookOpen className="w-5 h-5" />
            æœ¬é€±å­¸ç¿’é€²åº¦
          </h2>
          <span className="text-2xl font-bold text-blue-600">
            {student.weeklyProgress}%
          </span>
        </div>
        <Progress value={student.weeklyProgress} className="h-3" />
        <p className="text-sm text-gray-600 mt-2">
          å·²å®Œæˆ {student.completedLessons} / {student.totalLessons} èª²
        </p>
      </Card>

      {/* å¾…å®Œæˆä½œæ¥­ */}
      <div className="mb-6">
        <h2 className="text-2xl font-bold mb-4 flex items-center gap-2">
          <FileText className="w-6 h-6" />
          å¾…å®Œæˆä½œæ¥­ ({assignments.length})
        </h2>

        <div className="grid gap-4">
          {assignments.map(assignment => (
            <AssignmentCard key={assignment.id} assignment={assignment} />
          ))}
        </div>
      </div>

      {/* æœ€è¿‘ç²å¾—çš„æˆå°± */}
      <Card className="p-6">
        <h2 className="text-xl font-semibold mb-4 flex items-center gap-2">
          <Trophy className="w-5 h-5 text-yellow-500" />
          æœ€è¿‘ç²å¾—çš„æˆå°±
        </h2>
        <div className="flex gap-4">
          {student.recentAchievements.map(achievement => (
            <div key={achievement.id} className="flex flex-col items-center">
              <div className="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center text-3xl">
                {achievement.icon}
              </div>
              <span className="text-sm mt-2">{achievement.title}</span>
            </div>
          ))}
        </div>
      </Card>
    </div>
  );
}
```

---

### 2.3 ä½œæ¥­æäº¤é é¢ (æ ¸å¿ƒåŠŸèƒ½)

```tsx
// src/pages/student/Assignment.tsx
import { useState } from 'react';
import { useParams } from 'react-router-dom';
import { useMutation, useQuery } from '@tanstack/react-query';
import { Button } from '@/components/ui/button';
import { Card } from '@/components/ui/card';
import { Mic, Upload, Play, CheckCircle } from 'lucide-react';
import { AudioRecorder } from '@/components/AudioRecorder';

export function AssignmentPage() {
  const { assignmentId } = useParams();
  const [audioBlob, setAudioBlob] = useState<Blob | null>(null);
  const [isPlaying, setIsPlaying] = useState(false);

  const { data: assignment } = useQuery({
    queryKey: ['assignment', assignmentId],
    queryFn: () => api.get(`/assignments/${assignmentId}`),
  });

  const submitMutation = useMutation({
    mutationFn: async (audio: Blob) => {
      const formData = new FormData();
      formData.append('audio', audio, 'recording.mp3');
      formData.append('assignment_id', assignmentId);
      return api.post('/submissions', formData);
    },
    onSuccess: () => {
      toast.success('ä½œæ¥­æäº¤æˆåŠŸ!ç­‰å¾… AI è©•åˆ†ä¸­...');
      queryClient.invalidateQueries(['submissions']);
    },
  });

  return (
    <div className="container mx-auto p-6 max-w-3xl">
      {/* ä½œæ¥­æ¨™é¡Œ */}
      <Card className="p-6 mb-6">
        <h1 className="text-2xl font-bold mb-2">{assignment.title}</h1>
        <p className="text-gray-600">{assignment.description}</p>

        {/* æˆªæ­¢æ™‚é–“ */}
        <div className="mt-4 flex items-center gap-2 text-orange-600">
          <Clock className="w-4 h-4" />
          <span>æˆªæ­¢æ™‚é–“: {formatDate(assignment.due_date)}</span>
        </div>
      </Card>

      {/* èª²æ–‡å…§å®¹ */}
      <Card className="p-6 mb-6">
        <h2 className="text-xl font-semibold mb-4">ğŸ“– èª²æ–‡å…§å®¹</h2>
        <div className="prose prose-lg">
          {assignment.lesson.content}
        </div>

        {/* ç¤ºç¯„éŸ³æª” */}
        <Button variant="outline" className="mt-4">
          <Play className="w-4 h-4 mr-2" />
          æ’­æ”¾ç¤ºç¯„æœ—è®€
        </Button>
      </Card>

      {/* éŒ„éŸ³ / ä¸Šå‚³ */}
      <Card className="p-6">
        <h2 className="text-xl font-semibold mb-4">ğŸ¤ é–‹å§‹éŒ„éŸ³</h2>

        <AudioRecorder
          onRecordingComplete={setAudioBlob}
          maxDuration={120} // æœ€å¤š 2 åˆ†é˜
        />

        {/* æ’­æ”¾éŒ„éŸ³ */}
        {audioBlob && (
          <div className="mt-4">
            <audio
              src={URL.createObjectURL(audioBlob)}
              controls
              className="w-full"
            />
          </div>
        )}

        {/* æäº¤æŒ‰éˆ• */}
        <Button
          size="lg"
          className="w-full mt-6"
          disabled={!audioBlob || submitMutation.isPending}
          onClick={() => submitMutation.mutate(audioBlob)}
        >
          {submitMutation.isPending ? (
            <>
              <Loader2 className="w-5 h-5 mr-2 animate-spin" />
              ä¸Šå‚³ä¸­...
            </>
          ) : (
            <>
              <Upload className="w-5 h-5 mr-2" />
              æäº¤ä½œæ¥­
            </>
          )}
        </Button>
      </Card>

      {/* å·²æäº¤ç‹€æ…‹ */}
      {assignment.submission && (
        <Card className="p-6 mt-6 border-green-200 bg-green-50">
          <div className="flex items-center gap-3">
            <CheckCircle className="w-8 h-8 text-green-600" />
            <div>
              <h3 className="font-semibold text-green-900">å·²æäº¤ä½œæ¥­</h3>
              <p className="text-sm text-green-700">
                æäº¤æ™‚é–“: {formatDate(assignment.submission.submitted_at)}
              </p>
              {assignment.submission.final_score && (
                <p className="text-lg font-bold text-green-900 mt-2">
                  å¾—åˆ†: {assignment.submission.final_score} / 100
                </p>
              )}
            </div>
          </div>
        </Card>
      )}
    </div>
  );
}
```

---

### 2.4 éŒ„éŸ³çµ„ä»¶ (é‡ç”¨)

```tsx
// src/components/AudioRecorder.tsx
import { useState, useRef } from 'react';
import { Button } from '@/components/ui/button';
import { Mic, Square, Play, Pause } from 'lucide-react';

interface Props {
  onRecordingComplete: (blob: Blob) => void;
  maxDuration?: number; // ç§’
}

export function AudioRecorder({ onRecordingComplete, maxDuration = 120 }: Props) {
  const [isRecording, setIsRecording] = useState(false);
  const [duration, setDuration] = useState(0);
  const mediaRecorderRef = useRef<MediaRecorder | null>(null);
  const chunksRef = useRef<Blob[]>([]);

  const startRecording = async () => {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    const mediaRecorder = new MediaRecorder(stream);

    mediaRecorder.ondataavailable = (e) => {
      chunksRef.current.push(e.data);
    };

    mediaRecorder.onstop = () => {
      const blob = new Blob(chunksRef.current, { type: 'audio/mp3' });
      onRecordingComplete(blob);
      chunksRef.current = [];
    };

    mediaRecorder.start();
    mediaRecorderRef.current = mediaRecorder;
    setIsRecording(true);

    // è¨ˆæ™‚å™¨
    const interval = setInterval(() => {
      setDuration(prev => {
        if (prev >= maxDuration) {
          stopRecording();
          clearInterval(interval);
          return maxDuration;
        }
        return prev + 1;
      });
    }, 1000);
  };

  const stopRecording = () => {
    mediaRecorderRef.current?.stop();
    setIsRecording(false);
    setDuration(0);
  };

  return (
    <div className="flex flex-col items-center gap-4">
      {/* éŒ„éŸ³æ™‚é–“é¡¯ç¤º */}
      {isRecording && (
        <div className="text-4xl font-mono font-bold text-red-600">
          {formatDuration(duration)} / {formatDuration(maxDuration)}
        </div>
      )}

      {/* éŒ„éŸ³æŒ‰éˆ• */}
      <Button
        size="lg"
        variant={isRecording ? 'destructive' : 'default'}
        className="w-32 h-32 rounded-full"
        onClick={isRecording ? stopRecording : startRecording}
      >
        {isRecording ? (
          <Square className="w-12 h-12" />
        ) : (
          <Mic className="w-12 h-12" />
        )}
      </Button>

      <p className="text-sm text-gray-600">
        {isRecording ? 'é»æ“Šåœæ­¢éŒ„éŸ³' : 'é»æ“Šé–‹å§‹éŒ„éŸ³'}
      </p>
    </div>
  );
}

function formatDuration(seconds: number): string {
  const mins = Math.floor(seconds / 60);
  const secs = seconds % 60;
  return `${mins}:${secs.toString().padStart(2, '0')}`;
}
```

---

## 3ï¸âƒ£ æ•™å¸«ç«¯è¨­è¨ˆ

### 3.1 é é¢çµæ§‹

```
/teacher
  â”œâ”€â”€ /dashboard (é¦–é : ç­ç´šæ¦‚è¦½)
  â”œâ”€â”€ /classrooms (ç­ç´šåˆ—è¡¨)
  â”œâ”€â”€ /classroom/:id (ç­ç´šè©³æƒ…: å­¸ç”Ÿåˆ—è¡¨ + ä½œæ¥­åˆ—è¡¨)
  â”œâ”€â”€ /assignment/:id/grade (æ‰¹æ”¹ä½œæ¥­: æ‰€æœ‰å­¸ç”Ÿæäº¤åˆ—è¡¨)
  â”œâ”€â”€ /student/:id (å­¸ç”Ÿå€‹äººæª”æ¡ˆ)
  â””â”€â”€ /analytics (æ•¸æ“šåˆ†æ)
```

---

### 3.2 æ‰¹æ”¹ä½œæ¥­é é¢ (æ ¸å¿ƒåŠŸèƒ½)

```tsx
// src/pages/teacher/GradeAssignment.tsx
import { useParams } from 'react-router-dom';
import { useQuery, useMutation } from '@tanstack/react-query';
import { Card } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Table } from '@/components/ui/table';
import { Badge } from '@/components/ui/badge';
import { Textarea } from '@/components/ui/textarea';
import { Play, CheckCircle, Clock, XCircle } from 'lucide-react';

export function GradeAssignmentPage() {
  const { assignmentId } = useParams();

  const { data: submissions } = useQuery({
    queryKey: ['submissions', assignmentId],
    queryFn: () => api.get(`/assignments/${assignmentId}/submissions`),
  });

  const updateScoreMutation = useMutation({
    mutationFn: ({ submissionId, score, feedback }: any) =>
      api.post(`/submissions/${submissionId}/score`, { score, feedback }),
    onSuccess: () => {
      toast.success('è©•åˆ†å·²æ›´æ–°');
      queryClient.invalidateQueries(['submissions', assignmentId]);
    },
  });

  return (
    <div className="container mx-auto p-6">
      {/* ä½œæ¥­æ¨™é¡Œ */}
      <div className="mb-6">
        <h1 className="text-3xl font-bold">{submissions?.assignment.title}</h1>
        <p className="text-gray-600 mt-2">
          å·²æäº¤: {submissions?.submitted_count} / {submissions?.total_students}
        </p>
      </div>

      {/* æ•´é«”çµ±è¨ˆ */}
      <div className="grid grid-cols-4 gap-4 mb-6">
        <Card className="p-4">
          <div className="text-sm text-gray-600">å¹³å‡åˆ†</div>
          <div className="text-3xl font-bold text-blue-600">
            {submissions?.average_score.toFixed(1)}
          </div>
        </Card>
        <Card className="p-4">
          <div className="text-sm text-gray-600">å·²æäº¤</div>
          <div className="text-3xl font-bold text-green-600">
            {submissions?.submitted_count}
          </div>
        </Card>
        <Card className="p-4">
          <div className="text-sm text-gray-600">å¾…æ‰¹æ”¹</div>
          <div className="text-3xl font-bold text-orange-600">
            {submissions?.pending_count}
          </div>
        </Card>
        <Card className="p-4">
          <div className="text-sm text-gray-600">å®Œæˆç‡</div>
          <div className="text-3xl font-bold text-purple-600">
            {submissions?.completion_rate.toFixed(0)}%
          </div>
        </Card>
      </div>

      {/* æäº¤åˆ—è¡¨ */}
      <Card>
        <Table>
          <TableHeader>
            <TableRow>
              <TableHead>å­¸ç”Ÿå§“å</TableHead>
              <TableHead>æäº¤æ™‚é–“</TableHead>
              <TableHead>AI è©•åˆ†</TableHead>
              <TableHead>æ•™å¸«è©•åˆ†</TableHead>
              <TableHead>ç‹€æ…‹</TableHead>
              <TableHead>æ“ä½œ</TableHead>
            </TableRow>
          </TableHeader>
          <TableBody>
            {submissions?.submissions.map(submission => (
              <SubmissionRow
                key={submission.submission_id}
                submission={submission}
                onUpdateScore={updateScoreMutation.mutate}
              />
            ))}
          </TableBody>
        </Table>
      </Card>
    </div>
  );
}

// æäº¤è¨˜éŒ„è¡Œçµ„ä»¶
function SubmissionRow({ submission, onUpdateScore }: any) {
  const [isEditing, setIsEditing] = useState(false);
  const [teacherScore, setTeacherScore] = useState(submission.teacher_score || '');
  const [feedback, setFeedback] = useState(submission.teacher_feedback || '');

  return (
    <TableRow>
      <TableCell className="font-medium">{submission.student.name}</TableCell>
      <TableCell>{formatDate(submission.submitted_at)}</TableCell>
      <TableCell>
        <Badge variant="secondary">
          {submission.ai_score?.toFixed(1) || '-'}
        </Badge>
      </TableCell>
      <TableCell>
        {isEditing ? (
          <Input
            type="number"
            value={teacherScore}
            onChange={(e) => setTeacherScore(e.target.value)}
            className="w-20"
            min="0"
            max="100"
          />
        ) : (
          <Badge variant={teacherScore ? 'default' : 'outline'}>
            {teacherScore || '-'}
          </Badge>
        )}
      </TableCell>
      <TableCell>
        {submission.status === 'graded' && <CheckCircle className="w-5 h-5 text-green-600" />}
        {submission.status === 'submitted' && <Clock className="w-5 h-5 text-orange-600" />}
      </TableCell>
      <TableCell>
        <div className="flex gap-2">
          {/* æ’­æ”¾éŸ³æª” */}
          <Button size="sm" variant="outline">
            <Play className="w-4 h-4" />
          </Button>

          {/* ç·¨è¼¯è©•åˆ† */}
          {isEditing ? (
            <Button
              size="sm"
              onClick={() => {
                onUpdateScore({
                  submissionId: submission.submission_id,
                  score: parseFloat(teacherScore),
                  feedback,
                });
                setIsEditing(false);
              }}
            >
              å„²å­˜
            </Button>
          ) : (
            <Button size="sm" variant="outline" onClick={() => setIsEditing(true)}>
              è©•åˆ†
            </Button>
          )}
        </div>
      </TableCell>
    </TableRow>
  );
}
```

---

### 3.3 æ•¸æ“šåˆ†æé é¢

```tsx
// src/pages/teacher/Analytics.tsx
import { useQuery } from '@tanstack/react-query';
import { Card } from '@/components/ui/card';
import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend } from 'recharts';
import { TrendingUp, Users, FileText } from 'lucide-react';

export function AnalyticsPage() {
  const { data: analytics } = useQuery({
    queryKey: ['analytics', 'classroom'],
    queryFn: () => api.get('/analytics/classroom'),
  });

  return (
    <div className="container mx-auto p-6">
      <h1 className="text-3xl font-bold mb-6">ç­ç´šæ•¸æ“šåˆ†æ</h1>

      {/* KPI å¡ç‰‡ */}
      <div className="grid grid-cols-3 gap-4 mb-6">
        <Card className="p-6">
          <div className="flex items-center justify-between">
            <div>
              <div className="text-sm text-gray-600">æœ¬é€±å¹³å‡åˆ†</div>
              <div className="text-3xl font-bold text-blue-600">
                {analytics?.weekly_average.toFixed(1)}
              </div>
            </div>
            <TrendingUp className="w-10 h-10 text-blue-600" />
          </div>
        </Card>
        {/* æ›´å¤š KPI... */}
      </div>

      {/* åˆ†æ•¸åˆ†å¸ƒåœ– */}
      <Card className="p-6 mb-6">
        <h2 className="text-xl font-semibold mb-4">åˆ†æ•¸åˆ†å¸ƒ</h2>
        <BarChart width={800} height={300} data={analytics?.score_distribution}>
          <CartesianGrid strokeDasharray="3 3" />
          <XAxis dataKey="range" />
          <YAxis />
          <Tooltip />
          <Legend />
          <Bar dataKey="count" fill="#3b82f6" />
        </BarChart>
      </Card>

      {/* å­¸ç”Ÿæ’å */}
      <Card className="p-6">
        <h2 className="text-xl font-semibold mb-4">å­¸ç”Ÿè¡¨ç¾æ’å</h2>
        <Table>
          <TableHeader>
            <TableRow>
              <TableHead>æ’å</TableHead>
              <TableHead>å­¸ç”Ÿå§“å</TableHead>
              <TableHead>å¹³å‡åˆ†</TableHead>
              <TableHead>å®Œæˆä½œæ¥­æ•¸</TableHead>
            </TableRow>
          </TableHeader>
          <TableBody>
            {analytics?.student_rankings.map((student, index) => (
              <TableRow key={student.student_id}>
                <TableCell>
                  <Badge variant={index < 3 ? 'default' : 'secondary'}>
                    #{index + 1}
                  </Badge>
                </TableCell>
                <TableCell>{student.name}</TableCell>
                <TableCell>{student.average_score.toFixed(1)}</TableCell>
                <TableCell>{student.completed_assignments}</TableCell>
              </TableRow>
            ))}
          </TableBody>
        </Table>
      </Card>
    </div>
  );
}
```

---

## 4ï¸âƒ£ ç‹€æ…‹ç®¡ç†

```typescript
// src/stores/authStore.ts
import { create } from 'zustand';
import { persist } from 'zustand/middleware';

interface AuthState {
  user: User | null;
  token: string | null;
  login: (token: string, user: User) => void;
  logout: () => void;
}

export const useAuthStore = create<AuthState>()(
  persist(
    (set) => ({
      user: null,
      token: null,
      login: (token, user) => set({ token, user }),
      logout: () => set({ token: null, user: null }),
    }),
    {
      name: 'auth-storage',
    }
  )
);
```

---

## 5ï¸âƒ£ API Client

```typescript
// src/lib/api.ts
import axios from 'axios';
import { useAuthStore } from '@/stores/authStore';

const api = axios.create({
  baseURL: import.meta.env.VITE_API_URL || 'http://localhost:3000/api',
});

// è‡ªå‹•é™„åŠ  Token
api.interceptors.request.use((config) => {
  const token = useAuthStore.getState().token;
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

// 401 è‡ªå‹•ç™»å‡º
api.interceptors.response.use(
  (response) => response.data,
  (error) => {
    if (error.response?.status === 401) {
      useAuthStore.getState().logout();
      window.location.href = '/login';
    }
    return Promise.reject(error);
  }
);

export default api;
```

---

## 6ï¸âƒ£ éŸ¿æ‡‰å¼è¨­è¨ˆ

```tsx
// ä½¿ç”¨ TailwindCSS éŸ¿æ‡‰å¼ class
<div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
  {/* æ‰‹æ©Ÿ: 1 åˆ—, å¹³æ¿: 2 åˆ—, æ¡Œæ©Ÿ: 3 åˆ— */}
</div>

// ä½¿ç”¨ React Hook æª¢æ¸¬è£ç½®
function useIsMobile() {
  const [isMobile, setIsMobile] = useState(false);

  useEffect(() => {
    const checkMobile = () => setIsMobile(window.innerWidth < 768);
    checkMobile();
    window.addEventListener('resize', checkMobile);
    return () => window.removeEventListener('resize', checkMobile);
  }, []);

  return isMobile;
}
```

---

## 7ï¸âƒ£ ç„¡éšœç¤™è¨­è¨ˆ (Accessibility)

```tsx
// ä½¿ç”¨ Radix UI (shadcn/ui) ä¿è­‰ç„¡éšœç¤™
import { Button } from '@/components/ui/button';
import { Dialog } from '@/components/ui/dialog';

// æ‰€æœ‰çµ„ä»¶è‡ªå‹•æ”¯æ´:
// - Keyboard navigation (Tab, Enter, Escape)
// - ARIA attributes
// - Screen reader support
// - Focus management

// æ‰‹å‹•æ·»åŠ  ARIA æ¨™ç±¤
<button
  aria-label="æ’­æ”¾éŸ³æª”"
  aria-pressed={isPlaying}
>
  <Play />
</button>
```

---

## 8ï¸âƒ£ æ•ˆèƒ½å„ªåŒ–

### 8.1 Code Splitting

```typescript
// src/App.tsx
import { lazy, Suspense } from 'react';

const StudentDashboard = lazy(() => import('./pages/student/Dashboard'));
const TeacherDashboard = lazy(() => import('./pages/teacher/Dashboard'));

function App() {
  return (
    <Suspense fallback={<LoadingSpinner />}>
      <Routes>
        <Route path="/student/*" element={<StudentDashboard />} />
        <Route path="/teacher/*" element={<TeacherDashboard />} />
      </Routes>
    </Suspense>
  );
}
```

### 8.2 React Query å¿«å–

```typescript
// src/lib/queryClient.ts
import { QueryClient } from '@tanstack/react-query';

export const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 5 * 60 * 1000, // 5 åˆ†é˜å…§ä¸é‡æ–°ç²å–
      cacheTime: 10 * 60 * 1000, // å¿«å– 10 åˆ†é˜
      refetchOnWindowFocus: false,
    },
  },
});
```

---

## 9ï¸âƒ£ æ¸¬è©¦

### 9.1 Component æ¸¬è©¦

```typescript
// src/components/__tests__/AudioRecorder.test.tsx
import { render, screen, fireEvent } from '@testing-library/react';
import { AudioRecorder } from '../AudioRecorder';

describe('AudioRecorder', () => {
  it('should start recording when button clicked', async () => {
    const onComplete = vi.fn();
    render(<AudioRecorder onRecordingComplete={onComplete} />);

    const button = screen.getByRole('button');
    fireEvent.click(button);

    expect(button).toHaveTextContent('åœæ­¢éŒ„éŸ³');
  });
});
```

### 9.2 E2E æ¸¬è©¦ (Playwright)

```typescript
// tests/student-submit-assignment.spec.ts
import { test, expect } from '@playwright/test';

test('student can submit assignment', async ({ page }) => {
  await page.goto('/login');

  // ç™»å…¥
  await page.fill('[name="email"]', 'student@example.com');
  await page.fill('[name="password"]', 'password');
  await page.click('button[type="submit"]');

  // é€²å…¥ä½œæ¥­é é¢
  await page.click('text=æœ—è®€èª²æ–‡');

  // éŒ„éŸ³ (æ¨¡æ“¬)
  await page.click('[aria-label="é–‹å§‹éŒ„éŸ³"]');
  await page.waitForTimeout(3000);
  await page.click('[aria-label="åœæ­¢éŒ„éŸ³"]');

  // æäº¤
  await page.click('text=æäº¤ä½œæ¥­');

  await expect(page.locator('text=ä½œæ¥­æäº¤æˆåŠŸ')).toBeVisible();
});
```

---

## 9ï¸âƒ£ Admin UI (èª²ç¨‹ç®¡ç†)

> **æ–°å¢åŠŸèƒ½**: æ•™å¸«å‹å–„çš„èª²ç¨‹å…§å®¹ç®¡ç†ä»‹é¢ (æ–¹æ¡ˆ H: GitHub + Admin UI)
>
> **è©³ç´°è¨­è¨ˆ**: åƒè€ƒ `AdminUIèª²ç¨‹ç®¡ç†è¨­è¨ˆ.md`

### 9.1 Admin UI æ¦‚è¿°

**è¨­è¨ˆç†å¿µ**:
```
å•é¡Œ: æ•™å¸«ä¸æœƒ Git â†’ è§£æ±º: æä¾› Web ç®¡ç†ä»‹é¢
å•é¡Œ: Markdown æœ‰å­¸ç¿’é–€æª» â†’ è§£æ±º: WYSIWYG ç·¨è¼¯å™¨
å„ªå‹¢: ä¿ç•™ GitHub ç‰ˆæœ¬æ§åˆ¶ â†’ èƒŒå¾Œè‡ªå‹• Git Commit
```

**è·¯ç”±çµæ§‹**:
```
/admin
  /lessons
    /                    # èª²ç¨‹åˆ—è¡¨
    /new                 # æ–°å¢èª²ç¨‹
    /:id/edit            # ç·¨è¼¯èª²ç¨‹
    /:id/history         # ç‰ˆæœ¬æ­·å²
```

---

### 9.2 æ ¸å¿ƒçµ„ä»¶

#### AdminLayout

```tsx
// components/layouts/AdminLayout.tsx

export function AdminLayout({ children }: { children: React.ReactNode }) {
  return (
    <div className="flex min-h-screen">
      {/* Sidebar */}
      <aside className="w-64 bg-gray-900 text-white">
        <div className="p-6">
          <h1 className="text-2xl font-bold">ç®¡ç†å¾Œå°</h1>
        </div>
        <nav className="space-y-1 px-3">
          <NavLink to="/admin/lessons">
            <BookOpen className="w-5 h-5" />
            èª²ç¨‹ç®¡ç†
          </NavLink>
          <NavLink to="/admin/assignments">
            <FileText className="w-5 h-5" />
            ä½œæ¥­æ‰¹æ”¹
          </NavLink>
          <NavLink to="/admin/analytics">
            <BarChart className="w-5 h-5" />
            æ•¸æ“šåˆ†æ
          </NavLink>
        </nav>
      </aside>

      {/* Main Content */}
      <main className="flex-1 bg-gray-50">
        {children}
      </main>
    </div>
  );
}
```

#### LessonEditor (TipTap)

```tsx
// components/admin/LessonEditor.tsx

import { useEditor, EditorContent } from '@tiptap/react';
import StarterKit from '@tiptap/starter-kit';

export function LessonEditor({ initialContent, onChange }) {
  const editor = useEditor({
    extensions: [StarterKit],
    content: initialContent,
    onUpdate: ({ editor }) => {
      onChange(editor.getHTML());
    },
  });

  return (
    <div>
      {/* Toolbar */}
      <div className="border-b p-2 flex gap-2">
        <ToolbarButton
          onClick={() => editor?.chain().focus().toggleBold().run()}
          active={editor?.isActive('bold')}
        >
          B
        </ToolbarButton>
        <ToolbarButton
          onClick={() => editor?.chain().focus().toggleItalic().run()}
          active={editor?.isActive('italic')}
        >
          I
        </ToolbarButton>
        <ToolbarButton
          onClick={() => editor?.chain().focus().toggleHeading({ level: 2 }).run()}
          active={editor?.isActive('heading')}
        >
          H2
        </ToolbarButton>
      </div>

      {/* Editor */}
      <EditorContent
        editor={editor}
        className="prose max-w-none p-4 min-h-[400px]"
      />
    </div>
  );
}
```

#### VocabularyEditor

```tsx
// components/admin/VocabularyEditor.tsx

import { DragDropContext, Droppable, Draggable } from 'react-beautiful-dnd';

export function VocabularyEditor({ vocabulary, onChange }) {
  const [isAdding, setIsAdding] = useState(false);

  const handleDragEnd = (result) => {
    if (!result.destination) return;
    const items = Array.from(vocabulary);
    const [reordered] = items.splice(result.source.index, 1);
    items.splice(result.destination.index, 0, reordered);
    onChange(items);
  };

  return (
    <div>
      <DragDropContext onDragEnd={handleDragEnd}>
        <Droppable droppableId="vocab">
          {(provided) => (
            <div {...provided.droppableProps} ref={provided.innerRef}>
              {vocabulary.map((word, index) => (
                <Draggable key={word.id} draggableId={word.id} index={index}>
                  {(provided) => (
                    <div
                      ref={provided.innerRef}
                      {...provided.draggableProps}
                      {...provided.dragHandleProps}
                      className="flex items-center gap-4 p-4 bg-white border rounded"
                    >
                      <span className="text-2xl font-bold">{word.character}</span>
                      <div>
                        <div className="text-sm text-gray-500">æ‹¼éŸ³</div>
                        <div>{word.pinyin}</div>
                      </div>
                      <div className="flex-1">
                        <div className="text-sm text-gray-500">è§£é‡‹</div>
                        <div>{word.definition}</div>
                      </div>
                      <button onClick={() => handleDelete(word.id)}>
                        <Trash2 className="w-5 h-5 text-red-500" />
                      </button>
                    </div>
                  )}
                </Draggable>
              ))}
              {provided.placeholder}
            </div>
          )}
        </Droppable>
      </DragDropContext>

      {isAdding ? (
        <VocabularyForm onSubmit={handleAdd} onCancel={() => setIsAdding(false)} />
      ) : (
        <button onClick={() => setIsAdding(true)} className="btn-dashed">
          + æ–°å¢ç”Ÿå­—
        </button>
      )}
    </div>
  );
}
```

#### AutoSaveIndicator

```tsx
// components/admin/AutoSaveIndicator.tsx

export function AutoSaveIndicator({ isSaving }: { isSaving: boolean }) {
  return (
    <div className="flex items-center gap-2 text-sm text-gray-500">
      {isSaving ? (
        <>
          <Loader2 className="w-4 h-4 animate-spin" />
          å„²å­˜ä¸­...
        </>
      ) : (
        <>
          <Check className="w-4 h-4 text-green-500" />
          å·²å„²å­˜
        </>
      )}
    </div>
  );
}
```

---

### 9.3 API æ•´åˆ

```typescript
// api/lessons.ts

import axios from 'axios';

export const lessonsApi = {
  // åˆ—è¡¨
  list: (filters?: { grade?: number; search?: string; page?: number }) =>
    axios.get('/api/lessons', { params: filters }).then(res => res.data),

  // è©³æƒ…
  get: (id: string) =>
    axios.get(`/api/lessons/${id}`).then(res => res.data),

  // æ–°å¢
  create: (data: CreateLessonDto) =>
    axios.post('/api/lessons', data).then(res => res.data),

  // æ›´æ–°
  update: (id: string, data: UpdateLessonDto) =>
    axios.put(`/api/lessons/${id}`, data).then(res => res.data),

  // åˆªé™¤
  delete: (id: string) =>
    axios.delete(`/api/lessons/${id}`).then(res => res.data),

  // ç™¼å¸ƒ
  publish: (id: string) =>
    axios.post(`/api/lessons/${id}/publish`).then(res => res.data),

  // ç‰ˆæœ¬æ­·å²
  getHistory: (id: string) =>
    axios.get(`/api/lessons/${id}/history`).then(res => res.data),

  // ç‰ˆæœ¬æ¯”å°
  getDiff: (id: string, from: string, to: string) =>
    axios.get(`/api/lessons/${id}/diff`, { params: { from, to } }).then(res => res.data),

  // å›å¾©ç‰ˆæœ¬
  revert: (id: string, commitHash: string) =>
    axios.post(`/api/lessons/${id}/revert`, { commit_hash: commitHash }).then(res => res.data),
};
```

---

### 9.4 React Query Hooks

```typescript
// hooks/useLessons.ts

import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { lessonsApi } from '@/api/lessons';

export function useLessons(filters) {
  return useQuery({
    queryKey: ['lessons', filters],
    queryFn: () => lessonsApi.list(filters),
  });
}

export function useLesson(id: string) {
  return useQuery({
    queryKey: ['lesson', id],
    queryFn: () => lessonsApi.get(id),
    enabled: !!id,
  });
}

export function useUpdateLesson() {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: ({ id, data }: { id: string; data: UpdateLessonDto }) =>
      lessonsApi.update(id, data),
    onSuccess: (_, { id }) => {
      queryClient.invalidateQueries({ queryKey: ['lesson', id] });
      queryClient.invalidateQueries({ queryKey: ['lessons'] });
    },
  });
}

export function usePublishLesson() {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: (id: string) => lessonsApi.publish(id),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['lessons'] });
    },
  });
}
```

---

### 9.5 Auto-Save Hook

```typescript
// hooks/useAutoSave.ts

import { useEffect, useRef } from 'react';
import { debounce } from 'lodash-es';

export function useAutoSave<T>(
  saveFn: (data: T) => void,
  data: T,
  delay = 5000,
) {
  const saveRef = useRef(
    debounce((data: T) => {
      saveFn(data);
    }, delay)
  );

  useEffect(() => {
    saveRef.current(data);
  }, [data]);

  useEffect(() => {
    return () => {
      saveRef.current.cancel();
    };
  }, []);
}
```

---

### 9.6 ä¾è³´å¥—ä»¶

```json
{
  "dependencies": {
    "@tiptap/react": "^2.1.0",
    "@tiptap/starter-kit": "^2.1.0",
    "react-beautiful-dnd": "^13.1.1",
    "react-diff-viewer": "^3.1.1",
    "lodash-es": "^4.17.21"
  }
}
```

---

### 9.7 é é¢ç¯„ä¾‹

**èª²ç¨‹åˆ—è¡¨é é¢**: `/admin/lessons`

```tsx
// pages/admin/lessons/index.tsx

export default function LessonsListPage() {
  const [filters, setFilters] = useState({ grade: null, search: '' });
  const { data: lessons, isLoading } = useLessons(filters);

  return (
    <AdminLayout>
      <div className="p-6">
        <div className="flex justify-between mb-6">
          <h1 className="text-3xl font-bold">èª²ç¨‹ç®¡ç†</h1>
          <Link to="/admin/lessons/new" className="btn-primary">
            + æ–°å¢èª²ç¨‹
          </Link>
        </div>

        {/* Filters */}
        <div className="flex gap-4 mb-6">
          <select
            value={filters.grade || ''}
            onChange={(e) => setFilters({ ...filters, grade: Number(e.target.value) || null })}
          >
            <option value="">æ‰€æœ‰å¹´ç´š</option>
            {[1, 2, 3, 4, 5, 6].map(g => <option key={g} value={g}>{g}å¹´ç´š</option>)}
          </select>
          <input
            type="text"
            placeholder="æœå°‹èª²ç¨‹..."
            value={filters.search}
            onChange={(e) => setFilters({ ...filters, search: e.target.value })}
          />
        </div>

        {/* Lessons Grid */}
        <div className="grid grid-cols-3 gap-6">
          {lessons?.map(lesson => <LessonCard key={lesson.id} lesson={lesson} />)}
        </div>
      </div>
    </AdminLayout>
  );
}
```

**èª²ç¨‹ç·¨è¼¯é é¢**: `/admin/lessons/:id/edit`

```tsx
// pages/admin/lessons/[id]/edit.tsx

export default function LessonEditPage() {
  const { id } = useParams();
  const { data: lesson } = useLesson(id);
  const updateMutation = useUpdateLesson();
  const publishMutation = usePublishLesson();

  const [formData, setFormData] = useState(lesson || {});

  useAutoSave(() => {
    updateMutation.mutate({ id, data: formData });
  }, formData, 5000);

  return (
    <AdminLayout>
      <div className="p-6 max-w-5xl mx-auto">
        <div className="flex justify-between mb-6">
          <div className="flex items-center gap-4">
            <Link to="/admin/lessons" className="btn-ghost">â† è¿”å›</Link>
            <h1 className="text-3xl font-bold">ç·¨è¼¯èª²ç¨‹</h1>
            <AutoSaveIndicator isSaving={updateMutation.isLoading} />
          </div>
          <div className="flex gap-2">
            <button onClick={() => updateMutation.mutate({ id, data: formData })} className="btn-secondary">
              å„²å­˜è‰ç¨¿
            </button>
            <button onClick={() => publishMutation.mutate(id)} className="btn-primary">
              ç™¼å¸ƒèª²ç¨‹
            </button>
          </div>
        </div>

        {/* Form Sections */}
        <div className="space-y-8">
          <BasicInfoSection data={formData} onChange={setFormData} />
          <ContentSection data={formData} onChange={setFormData} />
          <VocabularySection data={formData} onChange={setFormData} />
          <HomeworkSection data={formData} onChange={setFormData} />
          <HistorySection lessonId={id} />
        </div>
      </div>
    </AdminLayout>
  );
}
```

---

## ğŸ”Ÿ éƒ¨ç½²

### 10.1 Build é…ç½®

```typescript
// vite.config.ts
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [react()],
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          'react-vendor': ['react', 'react-dom', 'react-router-dom'],
          'ui-vendor': ['@radix-ui/react-dialog', '@radix-ui/react-dropdown-menu'],
          'chart-vendor': ['recharts'],
        },
      },
    },
  },
});
```

### 10.2 ç’°å¢ƒè®Šæ•¸

```bash
# .env.production
VITE_API_URL=https://api.platform.example.org.tw
VITE_GOOGLE_CLIENT_ID=xxx.apps.googleusercontent.com
```

---

## ğŸ¯ ç¸½çµ

### åŠŸèƒ½ç¢ºèª

| åŠŸèƒ½ | å­¸ç”Ÿç«¯ | æ•™å¸«ç«¯ |
|------|--------|--------|
| **ç™»å…¥** | âœ… Google OAuth | âœ… Google OAuth |
| **èª²ç¨‹ç€è¦½** | âœ… èª²æ–‡ + ç”Ÿå­— | âœ… èª²ç¨‹ç®¡ç† |
| **ä½œæ¥­æäº¤** | âœ… éŒ„éŸ³ + ä¸Šå‚³ | âŒ |
| **æ‰¹æ”¹ä½œæ¥­** | âŒ | âœ… AI è¼”åŠ©æ‰¹æ”¹ |
| **é€²åº¦è¿½è¹¤** | âœ… å€‹äººé€²åº¦ | âœ… ç­ç´šæ•¸æ“š |
| **æˆå°±ç³»çµ±** | âœ… å¾½ç«  + æ’å | âŒ |

### é–‹ç™¼æ™‚ç¨‹

| éšæ®µ | æ™‚é–“ | ç”¢å‡º |
|------|------|------|
| 1. åŸºç¤æ¶æ§‹ | 2 å¤© | Vite + Router + API Client |
| 2. UI çµ„ä»¶åº« | 2 å¤© | shadcn/ui è¨­å®š + è‡ªè¨‚çµ„ä»¶ |
| 3. å­¸ç”Ÿç«¯é é¢ | 4 å¤© | Dashboard + Assignment + Progress |
| 4. æ•™å¸«ç«¯é é¢ | 4 å¤© | Dashboard + Grading + Analytics |
| 5. éŒ„éŸ³åŠŸèƒ½ | 2 å¤© | AudioRecorder çµ„ä»¶ |
| 6. ç‹€æ…‹ç®¡ç† | 1 å¤© | Zustand + React Query |
| 7. æ¸¬è©¦ | 2 å¤© | Unit + E2E |
| 8. å„ªåŒ– | 2 å¤© | Code Splitting + Performance |
| **ç¸½è¨ˆ** | **19 å¤©** | å®Œæ•´å‰ç«¯æ‡‰ç”¨ |

---

## ğŸ“ å¾ŒçºŒæ–‡ä»¶

âœ… **å®Œæˆ**: è³‡æ–™åº« Schema è¨­è¨ˆ
âœ… **å®Œæˆ**: GitHub åŒæ­¥æœå‹™è¨­è¨ˆ
âœ… **å®Œæˆ**: Google Classroom æ•´åˆè¨­è¨ˆ
âœ… **å®Œæˆ**: AI è©•åˆ†å¼•æ“è¨­è¨ˆ
âœ… **å®Œæˆ**: å‰ç«¯è¨­è¨ˆ
â­ï¸ **ä¸‹ä¸€æ­¥**: éƒ¨ç½²æ¶æ§‹è¨­è¨ˆ.md
