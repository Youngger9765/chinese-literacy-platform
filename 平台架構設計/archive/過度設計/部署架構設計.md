# éƒ¨ç½²æ¶æ§‹è¨­è¨ˆ

> **ç›®æ¨™**: å®Œæ•´çš„ Docker + Kubernetes éƒ¨ç½²æ¶æ§‹,æ”¯æ´é–‹ç™¼ã€æ¸¬è©¦ã€æ­£å¼ç’°å¢ƒåˆ†é›¢
>
> **åŸå‰‡**: å®¹å™¨åŒ–ã€é«˜å¯ç”¨æ€§ã€è‡ªå‹•æ“´å±•ã€ç›£æ§å‘Šè­¦ã€ç½é›£æ¢å¾©

---

## ğŸ—ï¸ éƒ¨ç½²æ¶æ§‹ç¸½è¦½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CI/CD Pipeline                          â”‚
â”‚                      (GitHub Actions)                           â”‚
â”‚  Push â†’ Test â†’ Build â†’ Push Image â†’ Deploy â†’ Monitor          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“                        â†“                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Dev ç’°å¢ƒ        â”‚        â”‚   Staging ç’°å¢ƒ    â”‚   â”‚ Production   â”‚
â”‚  (Docker Compose)â”‚        â”‚  (K8s Cluster)   â”‚   â”‚ (K8s + Auto) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - æœ¬åœ°é–‹ç™¼       â”‚        â”‚ - Pre-prod æ¸¬è©¦  â”‚   â”‚ - ç”¨æˆ¶ç’°å¢ƒ   â”‚
â”‚ - Hot reload     â”‚        â”‚ - å®Œæ•´å‰¯æœ¬       â”‚   â”‚ - HA/DR      â”‚
â”‚ - Mock data      â”‚        â”‚ - æ•ˆèƒ½æ¸¬è©¦       â”‚   â”‚ - Scaling    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ³ Docker Compose (é–‹ç™¼ç’°å¢ƒ)

### ç›®éŒ„çµæ§‹

```
/docker
â”œâ”€â”€ docker-compose.yml       # é–‹ç™¼ç’°å¢ƒç·¨æ’
â”œâ”€â”€ docker-compose.prod.yml  # æ­£å¼ç’°å¢ƒç·¨æ’ (Swarm)
â”œâ”€â”€ Dockerfile.backend       # å¾Œç«¯å®¹å™¨
â”œâ”€â”€ Dockerfile.frontend      # å‰ç«¯å®¹å™¨
â”œâ”€â”€ Dockerfile.worker        # ä»»å‹™éšŠåˆ—å·¥ä½œè€…
â”œâ”€â”€ Dockerfile.whisper       # Whisper STT æœå‹™
â””â”€â”€ nginx/
    â””â”€â”€ nginx.conf           # åå‘ä»£ç†
```

### docker-compose.yml (é–‹ç™¼ç’°å¢ƒ)

```yaml
version: '3.9'

services:
  # ==================== è³‡æ–™åº« ====================
  postgres:
    image: postgres:15-alpine
    container_name: literacy-db
    environment:
      POSTGRES_DB: literacy_platform
      POSTGRES_USER: ${DB_USER}
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    volumes:
      - pgdata:/var/lib/postgresql/data
      - ./scripts/init.sql:/docker-entrypoint-initdb.d/init.sql
    ports:
      - "5432:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U $DB_USER"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - app-network

  # ==================== å¿«å– ====================
  redis:
    image: redis:7-alpine
    container_name: literacy-cache
    command: redis-server --appendonly yes --requirepass ${REDIS_PASSWORD}
    volumes:
      - redisdata:/data
    ports:
      - "6379:6379"
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - app-network

  # ==================== å¾Œç«¯ API ====================
  backend:
    build:
      context: .
      dockerfile: docker/Dockerfile.backend
      target: development
    container_name: literacy-backend
    environment:
      NODE_ENV: development
      DATABASE_URL: postgresql://${DB_USER}:${DB_PASSWORD}@postgres:5432/literacy_platform
      REDIS_URL: redis://:${REDIS_PASSWORD}@redis:6379
      AWS_S3_BUCKET: ${AWS_S3_BUCKET}
      AWS_REGION: ${AWS_REGION}
      AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID}
      AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY}
      GITHUB_TOKEN: ${GITHUB_TOKEN}
      GITHUB_REPO: ${GITHUB_REPO}
      GOOGLE_CLIENT_ID: ${GOOGLE_CLIENT_ID}
      GOOGLE_CLIENT_SECRET: ${GOOGLE_CLIENT_SECRET}
      WHISPER_API_KEY: ${WHISPER_API_KEY}
      JWT_SECRET: ${JWT_SECRET}
      LOG_LEVEL: debug
    ports:
      - "3001:3001"
    volumes:
      - ./backend:/app/backend
      - /app/backend/node_modules  # é˜²æ­¢ host node_modules æ±¡æŸ“
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
    networks:
      - app-network
    command: npm run dev

  # ==================== å‰ç«¯ ====================
  frontend:
    build:
      context: .
      dockerfile: docker/Dockerfile.frontend
      target: development
    container_name: literacy-frontend
    environment:
      VITE_API_URL: http://localhost:3001/api
      VITE_GOOGLE_CLIENT_ID: ${GOOGLE_CLIENT_ID}
    ports:
      - "3000:3000"
    volumes:
      - ./frontend:/app/frontend
      - /app/frontend/node_modules
    depends_on:
      - backend
    networks:
      - app-network
    command: npm run dev

  # ==================== éšŠåˆ—å·¥ä½œè€… ====================
  queue-worker:
    build:
      context: .
      dockerfile: docker/Dockerfile.worker
    container_name: literacy-worker
    environment:
      NODE_ENV: development
      DATABASE_URL: postgresql://${DB_USER}:${DB_PASSWORD}@postgres:5432/literacy_platform
      REDIS_URL: redis://:${REDIS_PASSWORD}@redis:6379
      AWS_S3_BUCKET: ${AWS_S3_BUCKET}
      AWS_REGION: ${AWS_REGION}
      AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID}
      AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY}
      WHISPER_API_KEY: ${WHISPER_API_KEY}
      LOG_LEVEL: debug
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
    networks:
      - app-network
    command: npm run worker

  # ==================== Whisper STT æœå‹™ ====================
  whisper-service:
    build:
      context: ./services/whisper
      dockerfile: Dockerfile
    container_name: literacy-whisper
    environment:
      OPENAI_API_KEY: ${WHISPER_API_KEY}
      PORT: 5000
    ports:
      - "5000:5000"
    networks:
      - app-network

  # ==================== åå‘ä»£ç† ====================
  nginx:
    image: nginx:alpine
    container_name: literacy-nginx
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./docker/nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./docker/nginx/ssl:/etc/nginx/ssl:ro
    depends_on:
      - frontend
      - backend
    networks:
      - app-network

networks:
  app-network:
    driver: bridge

volumes:
  pgdata:
  redisdata:
```

### .env.example (ç’°å¢ƒè®Šæ•¸)

```bash
# ==================== è³‡æ–™åº« ====================
DB_USER=literacy_user
DB_PASSWORD=your-secure-password-here
DB_HOST=postgres
DB_PORT=5432
DB_NAME=literacy_platform

# ==================== Redis ====================
REDIS_PASSWORD=your-redis-password-here
REDIS_HOST=redis
REDIS_PORT=6379

# ==================== AWS S3 ====================
AWS_S3_BUCKET=literacy-platform-bucket
AWS_REGION=ap-southeast-1
AWS_ACCESS_KEY_ID=your-aws-key-here
AWS_SECRET_ACCESS_KEY=your-aws-secret-here

# ==================== GitHub ====================
GITHUB_TOKEN=your-github-token-here
GITHUB_REPO=your-org/curriculum-repo

# ==================== Google OAuth ====================
GOOGLE_CLIENT_ID=your-client-id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=your-client-secret

# ==================== AI æœå‹™ ====================
WHISPER_API_KEY=your-openai-api-key

# ==================== JWT ====================
JWT_SECRET=your-super-secret-jwt-key

# ==================== å‰ç«¯ ====================
VITE_API_URL=http://localhost:3001/api
VITE_GOOGLE_CLIENT_ID=your-client-id.apps.googleusercontent.com

# ==================== æ—¥èªŒ ====================
LOG_LEVEL=debug
```

---

## â˜¸ï¸ Kubernetes éƒ¨ç½² (æ­£å¼ç’°å¢ƒ)

### ç›®éŒ„çµæ§‹

```
/k8s
â”œâ”€â”€ base/
â”‚   â”œâ”€â”€ namespace.yaml
â”‚   â”œâ”€â”€ postgres/
â”‚   â”‚   â”œâ”€â”€ statefulset.yaml
â”‚   â”‚   â”œâ”€â”€ service.yaml
â”‚   â”‚   â””â”€â”€ pvc.yaml
â”‚   â”œâ”€â”€ redis/
â”‚   â”‚   â”œâ”€â”€ deployment.yaml
â”‚   â”‚   â”œâ”€â”€ service.yaml
â”‚   â”‚   â””â”€â”€ configmap.yaml
â”‚   â”œâ”€â”€ backend/
â”‚   â”‚   â”œâ”€â”€ deployment.yaml
â”‚   â”‚   â”œâ”€â”€ service.yaml
â”‚   â”‚   â”œâ”€â”€ configmap.yaml
â”‚   â”‚   â””â”€â”€ secrets.yaml
â”‚   â”œâ”€â”€ frontend/
â”‚   â”‚   â”œâ”€â”€ deployment.yaml
â”‚   â”‚   â”œâ”€â”€ service.yaml
â”‚   â”‚   â””â”€â”€ configmap.yaml
â”‚   â”œâ”€â”€ worker/
â”‚   â”‚   â”œâ”€â”€ deployment.yaml
â”‚   â”‚   â””â”€â”€ configmap.yaml
â”‚   â”œâ”€â”€ whisper/
â”‚   â”‚   â”œâ”€â”€ deployment.yaml
â”‚   â”‚   â””â”€â”€ service.yaml
â”‚   â”œâ”€â”€ ingress.yaml
â”‚   â”œâ”€â”€ hpa.yaml
â”‚   â””â”€â”€ kustomization.yaml
â”œâ”€â”€ overlays/
â”‚   â”œâ”€â”€ dev/
â”‚   â”‚   â”œâ”€â”€ kustomization.yaml
â”‚   â”‚   â””â”€â”€ config.yaml
â”‚   â”œâ”€â”€ staging/
â”‚   â”‚   â”œâ”€â”€ kustomization.yaml
â”‚   â”‚   â””â”€â”€ config.yaml
â”‚   â””â”€â”€ production/
â”‚       â”œâ”€â”€ kustomization.yaml
â”‚       â””â”€â”€ config.yaml
â””â”€â”€ monitoring/
    â”œâ”€â”€ prometheus.yaml
    â”œâ”€â”€ grafana.yaml
    â””â”€â”€ alertmanager.yaml
```

### 1. Namespace & RBAC

```yaml
# k8s/base/namespace.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: literacy-platform
  labels:
    environment: production

---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: app-sa
  namespace: literacy-platform

---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: app-reader
rules:
  - apiGroups: [""]
    resources: ["configmaps"]
    verbs: ["get", "list", "watch"]
  - apiGroups: [""]
    resources: ["secrets"]
    verbs: ["get"]

---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: read-app-config
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: app-reader
subjects:
  - kind: ServiceAccount
    name: app-sa
    namespace: literacy-platform
```

### 2. PostgreSQL StatefulSet

```yaml
# k8s/base/postgres/statefulset.yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: postgres-pvc
  namespace: literacy-platform
spec:
  accessModes:
    - ReadWriteOnce
  storageClassName: fast-ssd
  resources:
    requests:
      storage: 50Gi

---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: postgres
  namespace: literacy-platform
spec:
  serviceName: postgres
  replicas: 1
  selector:
    matchLabels:
      app: postgres
  template:
    metadata:
      labels:
        app: postgres
    spec:
      containers:
        - name: postgres
          image: postgres:15-alpine
          ports:
            - containerPort: 5432
              name: postgres
          env:
            - name: POSTGRES_DB
              valueFrom:
                configMapKeyRef:
                  name: postgres-config
                  key: database
            - name: POSTGRES_USER
              valueFrom:
                secretKeyRef:
                  name: postgres-secret
                  key: username
            - name: POSTGRES_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: postgres-secret
                  key: password
            - name: PGDATA
              value: /var/lib/postgresql/data/pgdata
          volumeMounts:
            - name: postgres-storage
              mountPath: /var/lib/postgresql/data
            - name: init-scripts
              mountPath: /docker-entrypoint-initdb.d
          livenessProbe:
            exec:
              command:
                - /bin/sh
                - -c
                - pg_isready -U $POSTGRES_USER
            initialDelaySeconds: 30
            periodSeconds: 10
          readinessProbe:
            exec:
              command:
                - /bin/sh
                - -c
                - pg_isready -U $POSTGRES_USER
            initialDelaySeconds: 5
            periodSeconds: 5
          resources:
            requests:
              memory: "512Mi"
              cpu: "500m"
            limits:
              memory: "2Gi"
              cpu: "2"
      volumes:
        - name: init-scripts
          configMap:
            name: postgres-init
  volumeClaimTemplates:
    - metadata:
        name: postgres-storage
      spec:
        accessModes: ["ReadWriteOnce"]
        storageClassName: fast-ssd
        resources:
          requests:
            storage: 50Gi

---
apiVersion: v1
kind: Service
metadata:
  name: postgres
  namespace: literacy-platform
  labels:
    app: postgres
spec:
  clusterIP: None  # Headless service for StatefulSet
  selector:
    app: postgres
  ports:
    - port: 5432
      targetPort: 5432
      protocol: TCP
```

### 3. Redis Deployment

```yaml
# k8s/base/redis/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: redis
  namespace: literacy-platform
spec:
  replicas: 1
  selector:
    matchLabels:
      app: redis
  template:
    metadata:
      labels:
        app: redis
    spec:
      containers:
        - name: redis
          image: redis:7-alpine
          ports:
            - containerPort: 6379
              name: redis
          command:
            - redis-server
            - --requirepass
            - $(REDIS_PASSWORD)
            - --appendonly
            - "yes"
            - --maxmemory
            - "1024mb"
            - --maxmemory-policy
            - "allkeys-lru"
          env:
            - name: REDIS_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: redis-secret
                  key: password
          volumeMounts:
            - name: redis-storage
              mountPath: /data
          livenessProbe:
            exec:
              command:
                - redis-cli
                - ping
            initialDelaySeconds: 15
            periodSeconds: 10
          readinessProbe:
            exec:
              command:
                - redis-cli
                - ping
            initialDelaySeconds: 5
            periodSeconds: 5
          resources:
            requests:
              memory: "256Mi"
              cpu: "100m"
            limits:
              memory: "1Gi"
              cpu: "500m"
      volumes:
        - name: redis-storage
          emptyDir: {}

---
apiVersion: v1
kind: Service
metadata:
  name: redis
  namespace: literacy-platform
  labels:
    app: redis
spec:
  type: ClusterIP
  selector:
    app: redis
  ports:
    - port: 6379
      targetPort: 6379
      protocol: TCP
```

### 4. å¾Œç«¯ Deployment

```yaml
# k8s/base/backend/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: backend
  namespace: literacy-platform
  labels:
    app: backend
spec:
  replicas: 3  # åˆå§‹å‰¯æœ¬æ•¸,å— HPA æ§åˆ¶
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0
  selector:
    matchLabels:
      app: backend
  template:
    metadata:
      labels:
        app: backend
      annotations:
        prometheus.io/scrape: "true"
        prometheus.io/port: "3001"
        prometheus.io/path: "/metrics"
    spec:
      serviceAccountName: app-sa
      securityContext:
        runAsNonRoot: true
        runAsUser: 1000
      containers:
        - name: backend
          image: your-registry/literacy-backend:latest
          imagePullPolicy: Always
          ports:
            - containerPort: 3001
              name: http
            - containerPort: 9090
              name: metrics
          env:
            - name: NODE_ENV
              value: production
            - name: DATABASE_URL
              valueFrom:
                secretKeyRef:
                  name: backend-secret
                  key: database-url
            - name: REDIS_URL
              valueFrom:
                secretKeyRef:
                  name: backend-secret
                  key: redis-url
            - name: AWS_S3_BUCKET
              valueFrom:
                configMapKeyRef:
                  name: backend-config
                  key: aws-s3-bucket
            - name: AWS_REGION
              valueFrom:
                configMapKeyRef:
                  name: backend-config
                  key: aws-region
            - name: AWS_ACCESS_KEY_ID
              valueFrom:
                secretKeyRef:
                  name: backend-secret
                  key: aws-access-key
            - name: AWS_SECRET_ACCESS_KEY
              valueFrom:
                secretKeyRef:
                  name: backend-secret
                  key: aws-secret-key
            - name: GITHUB_TOKEN
              valueFrom:
                secretKeyRef:
                  name: backend-secret
                  key: github-token
            - name: GOOGLE_CLIENT_ID
              valueFrom:
                secretKeyRef:
                  name: backend-secret
                  key: google-client-id
            - name: GOOGLE_CLIENT_SECRET
              valueFrom:
                secretKeyRef:
                  name: backend-secret
                  key: google-client-secret
            - name: JWT_SECRET
              valueFrom:
                secretKeyRef:
                  name: backend-secret
                  key: jwt-secret
            - name: LOG_LEVEL
              value: info
          livenessProbe:
            httpGet:
              path: /health
              port: 3001
            initialDelaySeconds: 30
            periodSeconds: 10
            timeoutSeconds: 5
          readinessProbe:
            httpGet:
              path: /ready
              port: 3001
            initialDelaySeconds: 10
            periodSeconds: 5
            timeoutSeconds: 3
          resources:
            requests:
              memory: "512Mi"
              cpu: "500m"
            limits:
              memory: "1Gi"
              cpu: "1"
          securityContext:
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop:
                - ALL
          volumeMounts:
            - name: tmp
              mountPath: /tmp
      volumes:
        - name: tmp
          emptyDir: {}

---
apiVersion: v1
kind: Service
metadata:
  name: backend
  namespace: literacy-platform
  labels:
    app: backend
spec:
  type: ClusterIP
  selector:
    app: backend
  ports:
    - port: 3001
      targetPort: 3001
      protocol: TCP
      name: http
```

### 5. å‰ç«¯ Deployment

```yaml
# k8s/base/frontend/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: frontend
  namespace: literacy-platform
  labels:
    app: frontend
spec:
  replicas: 2
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0
  selector:
    matchLabels:
      app: frontend
  template:
    metadata:
      labels:
        app: frontend
    spec:
      containers:
        - name: frontend
          image: your-registry/literacy-frontend:latest
          imagePullPolicy: Always
          ports:
            - containerPort: 3000
              name: http
          env:
            - name: VITE_API_URL
              valueFrom:
                configMapKeyRef:
                  name: frontend-config
                  key: api-url
            - name: VITE_GOOGLE_CLIENT_ID
              valueFrom:
                secretKeyRef:
                  name: frontend-secret
                  key: google-client-id
          livenessProbe:
            httpGet:
              path: /
              port: 3000
            initialDelaySeconds: 15
            periodSeconds: 10
          readinessProbe:
            httpGet:
              path: /
              port: 3000
            initialDelaySeconds: 5
            periodSeconds: 5
          resources:
            requests:
              memory: "256Mi"
              cpu: "100m"
            limits:
              memory: "512Mi"
              cpu: "500m"

---
apiVersion: v1
kind: Service
metadata:
  name: frontend
  namespace: literacy-platform
spec:
  type: ClusterIP
  selector:
    app: frontend
  ports:
    - port: 3000
      targetPort: 3000
      protocol: TCP
```

### 6. ä»»å‹™éšŠåˆ— Worker

```yaml
# k8s/base/worker/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: queue-worker
  namespace: literacy-platform
spec:
  replicas: 2  # å¯æ ¹æ“š Redis éšŠåˆ—é•·åº¦è‡ªå‹•æ“´å±•
  selector:
    matchLabels:
      app: queue-worker
  template:
    metadata:
      labels:
        app: queue-worker
    spec:
      serviceAccountName: app-sa
      containers:
        - name: worker
          image: your-registry/literacy-worker:latest
          imagePullPolicy: Always
          env:
            - name: NODE_ENV
              value: production
            - name: DATABASE_URL
              valueFrom:
                secretKeyRef:
                  name: backend-secret
                  key: database-url
            - name: REDIS_URL
              valueFrom:
                secretKeyRef:
                  name: backend-secret
                  key: redis-url
            - name: WHISPER_API_KEY
              valueFrom:
                secretKeyRef:
                  name: backend-secret
                  key: whisper-api-key
            - name: AWS_S3_BUCKET
              valueFrom:
                configMapKeyRef:
                  name: backend-config
                  key: aws-s3-bucket
            - name: AWS_ACCESS_KEY_ID
              valueFrom:
                secretKeyRef:
                  name: backend-secret
                  key: aws-access-key
            - name: AWS_SECRET_ACCESS_KEY
              valueFrom:
                secretKeyRef:
                  name: backend-secret
                  key: aws-secret-key
            - name: LOG_LEVEL
              value: info
          resources:
            requests:
              memory: "512Mi"
              cpu: "500m"
            limits:
              memory: "1Gi"
              cpu: "1"
          livenessProbe:
            exec:
              command:
                - /bin/sh
                - -c
                - ps aux | grep "queue-worker" | grep -v grep
            initialDelaySeconds: 30
            periodSeconds: 30
```

### 7. Ingress é…ç½®

```yaml
# k8s/base/ingress.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: app-ingress
  namespace: literacy-platform
  annotations:
    kubernetes.io/ingress.class: nginx
    cert-manager.io/cluster-issuer: letsencrypt-prod
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/rate-limit: "100"
    nginx.ingress.kubernetes.io/use-regex: "true"
spec:
  tls:
    - hosts:
        - api.literacy-platform.com
        - literacy-platform.com
      secretName: app-tls-cert
  rules:
    - host: literacy-platform.com
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: frontend
                port:
                  number: 3000
    - host: api.literacy-platform.com
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: backend
                port:
                  number: 3001
```

### 8. HPA (è‡ªå‹•æ“´å±•)

```yaml
# k8s/base/hpa.yaml
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: backend-hpa
  namespace: literacy-platform
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: backend
  minReplicas: 3
  maxReplicas: 10
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 70
    - type: Resource
      resource:
        name: memory
        target:
          type: Utilization
          averageUtilization: 80
  behavior:
    scaleDown:
      stabilizationWindowSeconds: 300
      policies:
        - type: Percent
          value: 50
          periodSeconds: 60
    scaleUp:
      stabilizationWindowSeconds: 0
      policies:
        - type: Percent
          value: 100
          periodSeconds: 15
        - type: Pods
          value: 2
          periodSeconds: 15
      selectPolicy: Max

---
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: worker-hpa
  namespace: literacy-platform
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: queue-worker
  minReplicas: 2
  maxReplicas: 5
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 80
```

---

## ğŸ”„ CI/CD Pipeline (GitHub Actions)

### .github/workflows/deploy.yml

```yaml
name: Deploy to Kubernetes

on:
  push:
    branches:
      - main
      - staging
      - develop

env:
  REGISTRY: ghcr.io
  BACKEND_IMAGE: ${{ github.repository }}/backend
  FRONTEND_IMAGE: ${{ github.repository }}/frontend
  WORKER_IMAGE: ${{ github.repository }}/worker

jobs:
  # ==================== æ¸¬è©¦éšæ®µ ====================
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Run linter
        run: npm run lint

      - name: Run unit tests
        run: npm run test:unit

      - name: Run integration tests
        run: npm run test:integration
        env:
          DATABASE_URL: postgresql://test:test@localhost:5432/test_db
          REDIS_URL: redis://localhost:6379

      - name: Upload coverage
        uses: codecov/codecov-action@v3
        with:
          file: ./coverage/coverage-final.json

  # ==================== æ§‹å»ºæ˜ åƒ ====================
  build:
    needs: test
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
    steps:
      - uses: actions/checkout@v3

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v2

      - name: Log in to Container Registry
        uses: docker/login-action@v2
        with:
          registry: ${{ env.REGISTRY }}
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      - name: Extract metadata
        id: meta-backend
        uses: docker/metadata-action@v4
        with:
          images: ${{ env.REGISTRY }}/${{ env.BACKEND_IMAGE }}
          tags: |
            type=ref,event=branch
            type=sha,prefix={{branch}}-
            type=semver,pattern={{version}}

      - name: Build and push Backend image
        uses: docker/build-push-action@v4
        with:
          context: .
          file: ./docker/Dockerfile.backend
          push: true
          tags: ${{ steps.meta-backend.outputs.tags }}
          labels: ${{ steps.meta-backend.outputs.labels }}
          cache-from: type=registry,ref=${{ env.REGISTRY }}/${{ env.BACKEND_IMAGE }}:buildcache
          cache-to: type=registry,ref=${{ env.REGISTRY }}/${{ env.BACKEND_IMAGE }}:buildcache,mode=max

      - name: Extract metadata (Frontend)
        id: meta-frontend
        uses: docker/metadata-action@v4
        with:
          images: ${{ env.REGISTRY }}/${{ env.FRONTEND_IMAGE }}
          tags: |
            type=ref,event=branch
            type=sha,prefix={{branch}}-
            type=semver,pattern={{version}}

      - name: Build and push Frontend image
        uses: docker/build-push-action@v4
        with:
          context: .
          file: ./docker/Dockerfile.frontend
          push: true
          tags: ${{ steps.meta-frontend.outputs.tags }}
          labels: ${{ steps.meta-frontend.outputs.labels }}

      - name: Extract metadata (Worker)
        id: meta-worker
        uses: docker/metadata-action@v4
        with:
          images: ${{ env.REGISTRY }}/${{ env.WORKER_IMAGE }}
          tags: |
            type=ref,event=branch
            type=sha,prefix={{branch}}-

      - name: Build and push Worker image
        uses: docker/build-push-action@v4
        with:
          context: .
          file: ./docker/Dockerfile.worker
          push: true
          tags: ${{ steps.meta-worker.outputs.tags }}
          labels: ${{ steps.meta-worker.outputs.labels }}

  # ==================== éƒ¨ç½²åˆ° Staging ====================
  deploy-staging:
    if: github.ref == 'refs/heads/staging'
    needs: build
    runs-on: ubuntu-latest
    environment: staging
    steps:
      - uses: actions/checkout@v3

      - name: Set up kubectl
        uses: azure/setup-kubectl@v3
        with:
          version: v1.27.0

      - name: Configure kubeconfig
        run: |
          mkdir -p $HOME/.kube
          echo "${{ secrets.KUBE_CONFIG_STAGING }}" | base64 -d > $HOME/.kube/config
          chmod 600 $HOME/.kube/config

      - name: Deploy to Staging
        run: |
          kubectl config use-context staging
          kubectl set image deployment/backend \
            backend=${{ env.REGISTRY }}/${{ env.BACKEND_IMAGE }}:staging-${{ github.sha }} \
            -n literacy-platform
          kubectl set image deployment/frontend \
            frontend=${{ env.REGISTRY }}/${{ env.FRONTEND_IMAGE }}:staging-${{ github.sha }} \
            -n literacy-platform
          kubectl set image deployment/queue-worker \
            worker=${{ env.REGISTRY }}/${{ env.WORKER_IMAGE }}:staging-${{ github.sha }} \
            -n literacy-platform
          kubectl rollout status deployment/backend -n literacy-platform

      - name: Run smoke tests
        run: |
          curl -f https://staging.literacy-platform.com/health || exit 1
          curl -f https://api-staging.literacy-platform.com/health || exit 1

  # ==================== éƒ¨ç½²åˆ° Production ====================
  deploy-production:
    if: github.ref == 'refs/heads/main'
    needs: build
    runs-on: ubuntu-latest
    environment: production
    steps:
      - uses: actions/checkout@v3

      - name: Set up kubectl
        uses: azure/setup-kubectl@v3

      - name: Configure kubeconfig
        run: |
          mkdir -p $HOME/.kube
          echo "${{ secrets.KUBE_CONFIG_PRODUCTION }}" | base64 -d > $HOME/.kube/config
          chmod 600 $HOME/.kube/config

      - name: Deploy to Production
        run: |
          kubectl config use-context production
          kubectl set image deployment/backend \
            backend=${{ env.REGISTRY }}/${{ env.BACKEND_IMAGE }}:main-${{ github.sha }} \
            -n literacy-platform
          kubectl set image deployment/frontend \
            frontend=${{ env.REGISTRY }}/${{ env.FRONTEND_IMAGE }}:main-${{ github.sha }} \
            -n literacy-platform
          kubectl set image deployment/queue-worker \
            worker=${{ env.REGISTRY }}/${{ env.WORKER_IMAGE }}:main-${{ github.sha }} \
            -n literacy-platform
          kubectl rollout status deployment/backend -n literacy-platform --timeout=5m

      - name: Smoke tests
        run: |
          curl -f https://literacy-platform.com/health || exit 1
          curl -f https://api.literacy-platform.com/health || exit 1

      - name: Create Release
        uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tag_name: v${{ github.run_number }}
          release_name: Release v${{ github.run_number }}
          body: "Automated release from commit ${{ github.sha }}"

      - name: Notify Slack
        if: success()
        run: |
          curl -X POST ${{ secrets.SLACK_WEBHOOK }} \
            -H 'Content-Type: application/json' \
            -d '{
              "text": "Production deployment successful",
              "attachments": [{
                "color": "good",
                "text": "Version: v${{ github.run_number }}"
              }]
            }'

      - name: Notify Slack on failure
        if: failure()
        run: |
          curl -X POST ${{ secrets.SLACK_WEBHOOK }} \
            -H 'Content-Type: application/json' \
            -d '{
              "text": "Production deployment FAILED",
              "attachments": [{
                "color": "danger",
                "text": "Check GitHub Actions log"
              }]
            }'
```

---

## ğŸŒ ç’°å¢ƒå€åˆ†

### é–‹ç™¼ç’°å¢ƒ (Dev)

```yaml
# k8s/overlays/dev/kustomization.yaml
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: literacy-platform-dev

commonLabels:
  environment: dev

bases:
  - ../../base

patchesStrategicMerge:
  - deployment-patch.yaml

configMapGenerator:
  - name: backend-config
    literals:
      - log-level=debug
      - cache-ttl=300
  - name: frontend-config
    literals:
      - api-url=http://localhost:3001/api

replicas:
  - name: backend
    count: 1
  - name: frontend
    count: 1
  - name: queue-worker
    count: 1

resources:
  - namespace.yaml
```

### Staging ç’°å¢ƒ

```yaml
# k8s/overlays/staging/kustomization.yaml
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: literacy-platform-staging

commonLabels:
  environment: staging

bases:
  - ../../base

patchesStrategicMerge:
  - deployment-patch.yaml

configMapGenerator:
  - name: backend-config
    literals:
      - log-level=info
      - cache-ttl=3600

replicas:
  - name: backend
    count: 2
  - name: frontend
    count: 2
  - name: queue-worker
    count: 2

resources:
  - namespace.yaml
```

### Production ç’°å¢ƒ

```yaml
# k8s/overlays/production/kustomization.yaml
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: literacy-platform

commonLabels:
  environment: production

bases:
  - ../../base

patchesStrategicMerge:
  - deployment-patch.yaml
  - hpa-patch.yaml

configMapGenerator:
  - name: backend-config
    literals:
      - log-level=warn
      - cache-ttl=7200
      - enable-monitoring=true

secretGenerator:
  - name: postgres-secret
    envs:
      - secrets/db-credentials.env
  - name: backend-secret
    envs:
      - secrets/backend-credentials.env

replicas:
  - name: backend
    count: 3
  - name: frontend
    count: 2
  - name: queue-worker
    count: 3

policyRule:
  - apiGroups: ["policy"]
    apiVersions: ["v1"]
    resources: ["poddisruptionbudgets"]
    verbs: ["*"]

resources:
  - namespace.yaml
  - pod-disruption-budget.yaml
```

---

## ğŸ“¦ Docker æ–‡ä»¶ç¯„ä¾‹

### Dockerfile.backend

```dockerfile
# Build stage
FROM node:18-alpine AS builder

WORKDIR /build

COPY backend/package*.json ./backend/
RUN cd backend && npm ci

COPY backend ./backend
RUN cd backend && npm run build

# Production stage
FROM node:18-alpine

WORKDIR /app

# å®‰è£æ—¥èªŒå’Œç›£æ§å·¥å…·
RUN apk add --no-cache curl tini

# è¤‡è£½æ‡‰ç”¨
COPY --from=builder /build/backend/dist ./dist
COPY --from=builder /build/backend/package*.json ./

# å®‰è£ç”Ÿç”¢ä¾è³´
RUN npm ci --only=production

# å»ºç«‹é root ä½¿ç”¨è€…
RUN addgroup -g 1000 appuser && adduser -D -u 1000 -G appuser appuser
USER appuser

EXPOSE 3001 9090

HEALTHCHECK --interval=30s --timeout=10s --start-period=40s --retries=3 \
  CMD curl -f http://localhost:3001/health || exit 1

ENTRYPOINT ["/sbin/tini", "--"]
CMD ["node", "dist/index.js"]
```

### Dockerfile.frontend

```dockerfile
FROM node:18-alpine AS builder

WORKDIR /build

COPY frontend/package*.json ./
RUN npm ci

COPY frontend ./
ARG VITE_API_URL=http://localhost:3001/api
ENV VITE_API_URL=$VITE_API_URL

RUN npm run build

FROM nginx:alpine

RUN apk add --no-cache curl

COPY --from=builder /build/dist /usr/share/nginx/html

COPY docker/nginx/nginx.conf /etc/nginx/nginx.conf
COPY docker/nginx/default.conf /etc/nginx/conf.d/default.conf

EXPOSE 3000

HEALTHCHECK --interval=30s --timeout=10s --retries=3 \
  CMD curl -f http://localhost:3000 || exit 1

CMD ["nginx", "-g", "daemon off;"]
```

---

## ğŸ’¾ è³‡æ–™åº«é·ç§»ç­–ç•¥

### åˆå§‹é·ç§»æµç¨‹

```bash
#!/bin/bash
# scripts/migrate.sh

set -e

ENV=${1:-development}

echo "Running migrations for $ENV environment..."

# 1. å‚™ä»½ç¾æœ‰è³‡æ–™åº«
echo "Creating backup..."
pg_dump $DATABASE_URL > backup_$(date +%Y%m%d_%H%M%S).sql

# 2. åŸ·è¡Œé·ç§»
echo "Running migrations..."
npm run migrate:up

# 3. é©—è­‰é·ç§»
echo "Verifying schema..."
npm run migrate:verify

# 4. åŸ·è¡Œç¨®å­æ•¸æ“š
if [ "$ENV" = "development" ] || [ "$ENV" = "staging" ]; then
  echo "Seeding test data..."
  npm run seed
fi

echo "Migrations completed successfully!"
```

### é›¶åœæ©Ÿéƒ¨ç½² (Zero-Downtime Deployment)

```yaml
# k8s/base/postgres/migration-job.yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: db-migrate-{{ .Release.Time }}
  namespace: literacy-platform
spec:
  template:
    spec:
      serviceAccountName: app-sa
      containers:
        - name: migrate
          image: your-registry/literacy-backend:{{ .Values.image.tag }}
          command:
            - /bin/sh
            - -c
            - npm run migrate:up
          env:
            - name: DATABASE_URL
              valueFrom:
                secretKeyRef:
                  name: backend-secret
                  key: database-url
          resources:
            requests:
              memory: "256Mi"
              cpu: "100m"
            limits:
              memory: "512Mi"
              cpu: "500m"
      restartPolicy: Never
  backoffLimit: 3
```

---

## ğŸ”„ å‚™ä»½èˆ‡ç½é›£æ¢å¾©

### å‚™ä»½ç­–ç•¥

```yaml
# k8s/base/postgres/backup-cronjob.yaml
apiVersion: batch/v1
kind: CronJob
metadata:
  name: postgres-backup
  namespace: literacy-platform
spec:
  schedule: "0 2 * * *"  # æ¯å¤©å‡Œæ™¨ 2 é»
  jobTemplate:
    spec:
      template:
        spec:
          serviceAccountName: app-sa
          containers:
            - name: backup
              image: postgres:15-alpine
              command:
                - /bin/sh
                - -c
                - |
                  pg_dump $DATABASE_URL | \
                    gzip | \
                    aws s3 cp - s3://$BACKUP_BUCKET/postgres-$(date +%Y%m%d_%H%M%S).sql.gz
              env:
                - name: DATABASE_URL
                  valueFrom:
                    secretKeyRef:
                      name: postgres-secret
                      key: database-url
                - name: BACKUP_BUCKET
                  valueFrom:
                    configMapKeyRef:
                      name: backup-config
                      key: s3-bucket
                - name: AWS_ACCESS_KEY_ID
                  valueFrom:
                    secretKeyRef:
                      name: aws-backup
                      key: access-key
                - name: AWS_SECRET_ACCESS_KEY
                  valueFrom:
                    secretKeyRef:
                      name: aws-backup
                      key: secret-key
              resources:
                requests:
                  memory: "512Mi"
                  cpu: "500m"
                limits:
                  memory: "1Gi"
                  cpu: "1"
          restartPolicy: OnFailure
```

### ç½é›£æ¢å¾©è¨ˆåŠƒ (DRP)

```markdown
## ç½é›£æ¢å¾©è¨ˆåŠƒ (DRP)

### RTO èˆ‡ RPO ç›®æ¨™

| å±¤ç´š | RTO | RPO |
|------|-----|-----|
| è³‡æ–™åº« | 1 å°æ™‚ | 1 å°æ™‚ |
| æ‡‰ç”¨æœå‹™ | 15 åˆ†é˜ | N/A |
| å‰ç«¯ CDN | 5 åˆ†é˜ | N/A |

### æ¢å¾©ç¨‹åº

#### 1. è³‡æ–™åº«æ•…éšœæ¢å¾©

```bash
# 1. æª¢æŸ¥æœ€æ–°å‚™ä»½
aws s3 ls s3://literacy-backup/postgres/ --recursive | tail -10

# 2. ä¸‹è¼‰æœ€æ–°å‚™ä»½
aws s3 cp s3://literacy-backup/postgres/postgres-20240115_020000.sql.gz .
gunzip postgres-20240115_020000.sql.gz

# 3. æ¢å¾©åˆ°è‡¨æ™‚ PostgreSQL
psql -U postgres -h temp-db.internal < postgres-20240115_020000.sql

# 4. é©—è­‰æ•¸æ“šå®Œæ•´æ€§
SELECT COUNT(*) FROM students;
SELECT COUNT(*) FROM submissions;

# 5. åˆ‡æ›æ‡‰ç”¨é€£æ¥å­—ç¬¦ä¸²
kubectl patch deployment backend -p '{"spec":{"template":{"spec":{"containers":[{"name":"backend","env":[{"name":"DATABASE_URL","value":"postgresql://...temp-db..."}]}]}}}' -n literacy-platform

# 6. åŸ·è¡Œé·ç§»è…³æœ¬
kubectl exec -it backend-pod-name -- npm run migrate:up

# 7. æ¢å¾©åˆ°ç”Ÿç”¢è³‡æ–™åº«
# ... (é€šå¸¸é€šéè³‡æ–™åº«ç®¡ç†å“¡åŸ·è¡Œ)
```

#### 2. æ‡‰ç”¨æœå‹™æ•…éšœæ¢å¾©

```bash
# 1. å›æ»¾åˆ°ä¸Šä¸€å€‹ç©©å®šç‰ˆæœ¬
kubectl rollout undo deployment/backend -n literacy-platform

# 2. ç­‰å¾…å‰¯æœ¬æº–å‚™å¥½
kubectl rollout status deployment/backend -n literacy-platform

# 3. é©—è­‰æ‡‰ç”¨å¥åº·ç‹€æ…‹
curl https://api.literacy-platform.com/health

# 4. è‹¥å•é¡ŒæŒçºŒ,è‡¨æ™‚åˆ‡æ›æµé‡åˆ°å‚™ä»½å¯¦ä¾‹
kubectl set image deployment/backend backend=backup-registry/backend:latest -n literacy-platform
```

#### 3. å€åŸŸæ•…éšœæ¢å¾© (DR Site)

```bash
# 1. å•Ÿå‹•å‚™ç”¨ K8s é›†ç¾¤
gcloud container clusters create literacy-dr \
  --zone asia-southeast1-b \
  --num-nodes 3 \
  --machine-type n1-standard-2

# 2. å®‰è£ ArgoCD
kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml

# 3. æ¢å¾©æ‡‰ç”¨é…ç½®å’Œæ†‘è­‰
kubectl apply -f k8s/overlays/production/

# 4. å¾å‚™ä»½æ¢å¾©è³‡æ–™åº«
# ... (ä½¿ç”¨ pg_restore)

# 5. æ›´æ–° DNS æŒ‡å‘æ–°å€åŸŸ
gcloud dns record-sets update api.literacy-platform.com \
  --rrdatas 34.123.45.67 \
  --ttl 300 \
  --type A \
  --zone=literacy-zone
```
```
```

---

## ğŸ“Š æˆæœ¬ä¼°ç®—

### åŸºç¤è¨­æ–½æˆæœ¬ (500 å­¸ç”Ÿè¦æ¨¡)

| é …ç›® | è¦æ ¼ | æœˆæˆæœ¬ |
|------|------|--------|
| **Kubernetes é›†ç¾¤** | 3 å€‹ n1-standard-2 ç¯€é» | $180 |
| **PostgreSQL** | CloudSQL, 50GB, HA | $100 |
| **Redis** | CloudMemorystore, 5GB | $40 |
| **S3/Cloud Storage** | 100GB (éŸ³æª”) | $5 |
| **CDN (CloudFront)** | ~10TB æµé‡ | $50 |
| **è² è¼‰å‡è¡¡å™¨** | 1 å€‹å¯¦ä¾‹ | $20 |
| **å‚™ä»½å­˜å„²** | 30GB æ­·å²å‚™ä»½ | $10 |
| **ç›£æ§ (Datadog/New Relic)** | åŸºç¤è¨ˆåŠƒ | $30 |
| **DNS (Route53)** | æ¨™æº–è¨ˆè²» | $2 |
| **ç¸½è¨ˆ** | | **$437/æœˆ** |

**æ¯å­¸ç”Ÿæˆæœ¬**: $0.87/æœˆ

### æˆæœ¬å„ªåŒ–å»ºè­°

```yaml
# 1. ä½¿ç”¨ Spot å¯¦ä¾‹ (ç¯€çœ 70%)
nodePool:
  machineType: n1-standard-2
  preemptible: true  # æˆ– GKE Spot

# 2. è‡ªå‹•è³‡æºèª¿æ•´
hpa:
  minReplicas: 1      # ä½å³°æœŸå–®å‰¯æœ¬
  maxReplicas: 10
  targetCPU: 75%      # æé«˜ CPU åˆ©ç”¨ç‡

# 3. è³‡æ–™ç”Ÿå‘½é€±æœŸç®¡ç†
s3LifecyclePolicy:
  - transition: GLACIER after 90 days
  - expiration: after 1 year

# 4. å€åŸŸæœ€å„ªåŒ–
regions:
  primary: ap-southeast-1  # æ±å—äºæœ€ä¾¿å®œ
  backup: ap-southeast-2   # æ¾³æ´²å‚™ç”¨
```

---

## ğŸ” ç›£æ§èˆ‡å‘Šè­¦

### é—œéµæŒ‡æ¨™

```yaml
# k8s/monitoring/prometheus.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: prometheus-config
  namespace: monitoring
data:
  prometheus.yml: |
    global:
      scrape_interval: 15s
      evaluation_interval: 15s

    alerting:
      alertmanagers:
        - static_configs:
            - targets:
                - alertmanager:9093

    rule_files:
      - /etc/prometheus/rules/*.yml

    scrape_configs:
      - job_name: 'kubernetes-apiservers'
        kubernetes_sd_configs:
          - role: endpoints
        relabel_configs:
          - source_labels: [__meta_kubernetes_namespace]
            action: keep
            regex: default

      - job_name: 'literacy-backend'
        kubernetes_sd_configs:
          - role: pod
        relabel_configs:
          - source_labels: [__meta_kubernetes_pod_label_app]
            action: keep
            regex: backend
```

### å‘Šè­¦è¦å‰‡

```yaml
# k8s/monitoring/alert-rules.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: alert-rules
  namespace: monitoring
data:
  rules.yml: |
    groups:
      - name: app-alerts
        interval: 30s
        rules:
          - alert: HighErrorRate
            expr: rate(http_requests_total{status=~"5.."}[5m]) > 0.05
            for: 5m
            annotations:
              summary: "High error rate detected"

          - alert: DatabaseDown
            expr: up{job="postgres"} == 0
            for: 2m
            annotations:
              summary: "PostgreSQL is down"

          - alert: HighMemoryUsage
            expr: container_memory_usage_bytes / container_spec_memory_limit_bytes > 0.9
            for: 5m
            annotations:
              summary: "High memory usage: {{ $value | humanizePercentage }}"

          - alert: PodCrashLoop
            expr: rate(kube_pod_container_status_restarts_total[15m]) > 0.2
            for: 5m
            annotations:
              summary: "Pod {{ $labels.pod }} is in crash loop"
```

---

## âœ… éƒ¨ç½²æª¢æŸ¥æ¸…å–®

### éƒ¨ç½²å‰æª¢æŸ¥

- [ ] æ‰€æœ‰ Secret å·²é…ç½® (æ•¸æ“šåº«å¯†ç¢¼ã€API å¯†é‘°ç­‰)
- [ ] Docker æ˜ åƒå·²æ§‹å»ºä¸¦ä¸Šå‚³åˆ°å€‰åº«
- [ ] Kubernetes é›†ç¾¤å·²å°±ç·’
- [ ] DNS è¨˜éŒ„å·²æŒ‡å‘ Ingress
- [ ] SSL è­‰æ›¸å·²å®‰è£
- [ ] å‚™ä»½ç³»çµ±å·²å°±ç·’
- [ ] ç›£æ§å‘Šè­¦å·²é…ç½®
- [ ] è³‡æ–™åº«é·ç§»è…³æœ¬å·²æ¸¬è©¦

### éƒ¨ç½²å¾Œæª¢æŸ¥

- [ ] æ‰€æœ‰ Pod è™•æ–¼ Running ç‹€æ…‹
- [ ] å¥åº·æª¢æŸ¥é€šé
- [ ] API ç«¯é»å¯è¨ªå•
- [ ] å‰ç«¯é é¢åŠ è¼‰æ­£å¸¸
- [ ] è³‡æ–™åº«æŸ¥è©¢æ­£å¸¸
- [ ] Redis ç·©å­˜å·¥ä½œ
- [ ] S3 æ–‡ä»¶ä¸Šå‚³æ­£å¸¸
- [ ] æ—¥èªŒç„¡éŒ¯èª¤
- [ ] ç›£æ§å‘Šè­¦å•Ÿç”¨
- [ ] å‚™ä»½ä»»å‹™å·²åŸ·è¡Œ

---

## ğŸ¯ ç¸½çµ

### éƒ¨ç½²æ¶æ§‹å„ªé»

| ç‰¹æ€§ | èªªæ˜ |
|------|------|
| **å®¹å™¨åŒ–** | Docker ç¢ºä¿é–‹ç™¼ã€æ¸¬è©¦ã€ç”Ÿç”¢ç’°å¢ƒä¸€è‡´æ€§ |
| **é«˜å¯ç”¨** | K8s å¤šå‰¯æœ¬ã€è‡ªå‹•æ•…éšœè½‰ç§»ã€æ»¾å‹•å‡ç´š |
| **è‡ªå‹•æ“´å±•** | HPA æ ¹æ“š CPU/Memory è‡ªå‹•èª¿æ•´å‰¯æœ¬æ•¸ |
| **é›¶åœæ©Ÿéƒ¨ç½²** | æ»¾å‹•æ›´æ–°ã€DB é·ç§»å‰ç½®åŸ·è¡Œ |
| **ç›£æ§å‘Šè­¦** | Prometheus + Grafana å¯¦æ™‚æ€§èƒ½ç›£æ§ |
| **ç½é›£æ¢å¾©** | è‡ªå‹•å‚™ä»½ã€å¤šå€åŸŸè¤‡è£½ã€å¿«é€Ÿæ¢å¾©æµç¨‹ |
| **æˆæœ¬å„ªåŒ–** | Spot å¯¦ä¾‹ã€è³‡æºèª¿åº¦ã€ç”Ÿå‘½é€±æœŸç®¡ç† |

### é æœŸæ•ˆæœ

```
é–‹ç™¼é€±æœŸ:
- æœ¬åœ°é–‹ç™¼: Docker Compose (5 ç§’å•Ÿå‹•)
- Staging éƒ¨ç½²: ~2 åˆ†é˜ (è‡ªå‹•åŒ–)
- ç”Ÿç”¢éƒ¨ç½²: ~10 åˆ†é˜ (å« HPA é ç†±)

å¯é æ€§:
- å¯ç”¨æ€§: 99.9% SLA
- å¹³å‡æ•…éšœæ¢å¾©æ™‚é–“ (MTTR): < 15 åˆ†é˜
- å‚™ä»½ RPO: < 1 å°æ™‚

æˆæœ¬ (500 å­¸ç”Ÿ):
- æœˆæˆæœ¬: $437
- äººå‡æˆæœ¬: $0.87/æœˆ
```

---

## ğŸ“ å¾ŒçºŒæ–‡ä»¶

âœ… **å®Œæˆ**: éƒ¨ç½²æ¶æ§‹è¨­è¨ˆ
â­ï¸ **ä¸‹ä¸€æ­¥**: ç›£æ§å‘Šè­¦è¨­è¨ˆ.md
â­ï¸ **ä¸‹ä¸€æ­¥**: æ¸¬è©¦ç­–ç•¥.md
