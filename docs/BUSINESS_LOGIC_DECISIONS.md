# 教育平台商業邏輯決策記錄

> 記錄日期：2026-02-13
> 決策者：Young Tsai
> 用途：通用教育平台架構設計的核心商業邏輯

---

## 決策總覽

| 問題 | 決策 | 代碼 |
|------|------|------|
| 平台架構層級 | 機構 → 學校 → 班級 → 師生 | - |
| 學生自學模式 | 混合模式 | C |
| 課程更新機制 | 參照機制，可選擇同步 | B |
| 老師間分享 | 直接複製 | A |
| 課程 vs 作業 | 作業是課程的子集 | A |

---

## 問題 0：平台架構層級設計

### 問題描述
平台要支援多個教育機構使用（如：不同縣市教育局、私立教育集團、安親班連鎖等），架構應該如何設計？

### 選項

**A. 僅校級架構**
- 平台 → 學校 → 班級 → 師生
- 每個學校獨立註冊
- 無法統一管理多校

**B. 機構 + 學校架構** ✅
- 平台 → 機構 → 學校 → 班級 → 師生
- 機構可統一管理旗下多校
- 支援教育局、連鎖安親班等使用情境

**C. 扁平化架構**
- 平台 → 班級 → 師生
- 簡單但缺乏組織管理

### 決策：B（機構 + 學校架構）

### 理由
- **多租戶支援**：不同機構完全獨立（資料隔離）
- **彈性使用情境**：
  - 縣市教育局：機構 = 台北市教育局，旗下多所學校
  - 私立教育集團：機構 = 康橋教育集團，旗下多所分校
  - 連鎖安親班：機構 = 何嘉仁安親班，旗下多個分校
  - 單一學校：機構 = 學校（一對一）
- **分級管理**：
  - 機構管理員：管理旗下所有學校
  - 學校管理員：管理本校班級與教師
  - 教師：管理本班學生
- **商業模式彈性**：可依機構、學校或學生數計費

### 實作影響

**資料結構**：
- 需要 `organizations` 表（機構）
- 需要 `schools` 表，包含 `organization_id`
- 所有資料需要 `organization_id` 實現租戶隔離（Multi-tenancy）
- 需要階層式權限管理（機構管理員 > 學校管理員 > 教師）

**權限設計**：
```
機構管理員：
  - 管理旗下所有學校
  - 查看所有學校的統計報表
  - 設定機構級課程庫

學校管理員：
  - 管理本校班級與教師
  - 查看本校統計報表
  - 從機構課程庫複製課程到校級

教師：
  - 管理本班學生與作業
  - 查看本班學習報表
  - 從校級課程庫複製課程到班級
```

**課程複製路徑更新**：
```
官方課程（Platform）
    ↓ 複製
機構課程庫（Organization）
    ↓ 複製
校級課程庫（School）
    ↓ 複製
班級課程（Class）
    ↓ 選取模組 + 派發
作業（Assignment）
```

**資料隔離原則**（Multi-tenancy）：
- 所有查詢必須帶 `organization_id` 過濾條件
- 使用 Row Level Security (RLS) 確保資料安全
- 機構間資料完全隔離（無法跨機構查詢）
- 官方課程為平台級資源，所有機構可見

---

## 問題 1：學生自學模式

### 問題描述
學生想自學時，系統應該如何運作？

### 選項

**A. 完全開放自學**
- 學生可以直接瀏覽「官方課程」
- 複製到自己的學習清單
- AI 自動批改
- 不需要老師

**B. 僅限班級內學習**
- 學生只能學自己班上老師派發的課程
- 必須有老師
- 不能超前進度

**C. 混合模式** ✅
- 班級內：老師指派的作業（必做）
- 自學區：學生可以瀏覽官方課程自學（選做）

### 決策：C（混合模式）

### 理由
- 兼顧班級管理與自主學習
- 老師可以掌握必做作業的進度
- 學生有空間自主探索學習內容
- 符合教育趨勢（翻轉教育、自主學習）

### 實作影響
- 需要兩套學習路徑：
  1. 班級作業路徑（teacher_assigned = true）
  2. 自學路徑（teacher_assigned = false）
- 學生介面需要區分「班級作業」和「我的自學」
- AI 批改系統需支援無老師情境

---

## 問題 2：課程更新機制

### 問題描述
當官方課程更新時（例如修正錯字），校級課程或班級課程應該如何處理？

### 選項

**A. 完全複製，各自獨立**
- 校級/班級課程複製後完全獨立
- 官方更新不會自動影響下層
- 老師需要手動重新複製新版本
- 優點：穩定不被影響
- 缺點：錯誤不會自動修正

**B. 參照機制，可選擇同步** ✅
- 系統顯示提示「官方已更新至 v1.1，是否同步？」
- 老師可以選擇要不要更新
- 優點：可追蹤更新
- 缺點：實作較複雜

### 決策：B（參照機制，可選擇同步）

### 理由
- 官方課程修正錯誤時，學校可以選擇同步
- 保留老師的自主權（可選擇不同步）
- 提供版本追蹤機制
- 長期維護較友善（錯誤可以被修正）

### 實作影響
- 需要 `source_template_id` 欄位記錄來源
- 需要 `source_version` 欄位記錄複製時的版本
- 需要版本比對機制（current_version vs source_version）
- 需要「同步更新」功能（UI + API）
- 需要「更新通知」功能（通知老師有新版本）

---

## 問題 3：老師間分享

### 問題描述
王老師設計了一個很棒的班級課程，李老師想用，應該如何分享？

### 選項

**A. 直接複製** ✅
- 王老師班級課程 → 李老師複製 → 李老師班級課程
- 兩份後續完全獨立
- 班級對班級直接複製

**B. 發布到校級**
- 王老師先將課程發布到「校級課程庫」
- 李老師從校級課程複製
- 透過校級當中介

**C. 協作模式**
- 王老師、李老師共同編輯同一份課程
- 兩個班級都使用同一份課程

### 決策：A（直接複製）

### 理由
- 最簡單直接的方式
- 兩位老師的班級情況不同，複製後各自調整更彈性
- 避免協作衝突（不同老師教學風格不同）
- 減少校級課程庫的管理負擔

### 實作影響
- 需要「分享」功能（產生分享連結或班級內分享）
- 複製後完全獨立，source_template_id 指向原班級課程
- 不需要協作編輯功能
- 不需要校級發布審核流程

---

## 問題 4：課程 vs 作業

### 問題描述
「課程」與「作業」的關係是什麼？

### 選項

**A. 作業是課程的子集** ✅
- 課程包含：課文、生字、朗讀、筆順、閱讀理解等多個模組
- 作業：老師從課程中選取部分模組派發
- 例如：作業 1 只有朗讀，作業 2 只有筆順
- 一個課程可以產生多個不同的作業

**B. 課程 = 作業**
- 課程就是作業
- 老師派發整份課程給學生
- 學生要完成所有模組

### 決策：A（作業是課程的子集）

### 理由
- 更靈活：老師可以根據學生程度調整作業內容
- 符合真實教學情境：
  - 今天只練朗讀
  - 明天只練生字
  - 後天做閱讀理解
- 支援分層教學：
  - 進度快的學生做完整作業
  - 進度慢的學生只做部分模組
- 一個課程可以重複使用，產生不同作業

### 實作影響
- 課程（Course）包含多個學習模組（Modules）
- 作業（Assignment）= 課程 + 選取的模組清單
- 作業表需要 `selected_modules` 欄位（JSONB 或關聯表）
- 學生完成作業時，只需完成被選取的模組
- 作業進度計算：completed_modules / selected_modules

---

## 實作優先順序

### Phase 0：核心架構（必須優先）
0. ✅ 問題 0 決策：平台架構層級設計
   - 多租戶架構（Multi-tenancy）
   - 機構 → 學校 → 班級 → 師生 階層
   - Row Level Security (RLS) 資料隔離

### Phase 1：基礎架構（MVP）
1. ✅ 問題 4 決策：課程與作業的關係
   - 設計課程-模組-作業的資料結構
2. ✅ 問題 1 決策：學生自學模式
   - 實作班級作業 vs 自學兩條路徑

### Phase 2：進階功能
3. ✅ 問題 3 決策：老師間分享
   - 實作課程複製分享功能
4. ✅ 問題 2 決策：課程更新機制
   - 實作版本追蹤與同步機制
5. ✅ 問題 5 決策：知識樹/課程結構
   - Notion-like 階層式知識樹
   - 支援 category + prerequisite 雙模式

---

## 架構示意圖

### 完整層級架構

```
平台層（Platform）
    │
    ├─ 官方課程庫（Platform Courses）
    │
    └─ 機構層（Organizations）多租戶隔離
           │
           ├─ 機構 A（台北市教育局）
           │      │
           │      ├─ 機構課程庫（Organization Courses）
           │      │
           │      ├─ 學校 A1（中正國小）
           │      │      ├─ 校級課程庫
           │      │      └─ 班級（導師：王老師）
           │      │             └─ 作業 → 學生活動
           │      │
           │      └─ 學校 A2（信義國小）
           │             ├─ 校級課程庫
           │             └─ 班級（導師：李老師）
           │
           └─ 機構 B（康橋教育集團）
                  │
                  ├─ 機構課程庫
                  │
                  ├─ 學校 B1（康橋國際學校新竹校區）
                  └─ 學校 B2（康橋國際學校青山校區）
```

### 課程複製流程

```
官方課程（Platform）
    ↓ 複製（參照 + 可同步）
機構課程庫（Organization）
    ↓ 複製（參照 + 可同步）
校級課程庫（School）
    ↓ 複製（參照 + 可同步）
班級課程（Class）
    ↓ 選取模組 + 派發
作業（Assignment）
    ↓ 學生完成
學生活動（Student Activities）
```

**分享路徑**（同機構內）：
```
王老師班級課程 --複製--> 李老師班級課程（獨立）
```

**自學路徑**：
```
官方課程 --學生複製--> 我的自學課程 --自己完成--> AI 批改
```

**跨機構隔離**：
```
機構 A 的資料 ✗ 無法存取 ✗ 機構 B 的資料
（資料完全隔離，確保多租戶安全）
```

---

## 重要提醒

### 設計原則
1. **最小依賴、最大彈性**：每一層複製後獨立，避免連動影響
2. **保留追蹤能力**：source_template_id + source_version 可追溯來源
3. **選擇性同步**：有新版本時提示，由使用者決定要不要更新
4. **支援多元使用情境**：班級教學 + 個人自學並存

### 常見問題

**Q1：如果官方課程更新了，已經派發的作業會受影響嗎？**
A：不會。作業是「快照」（snapshot），派發時就凍結內容，不會被後續更新影響。

**Q2：如果學生在自學區選了一個課程，老師看得到進度嗎？**
A：看得到。學生活動表會記錄所有學習活動，但自學活動標記為 `teacher_assigned = false`。

**Q3：王老師分享課程給李老師後，王老師修改課程，李老師的版本會跟著改嗎？**
A：不會。李老師複製的是獨立副本，兩者完全獨立。

**Q4：如果一個課程包含 10 個模組，老師只想派其中 3 個當作業，其他 7 個怎麼辦？**
A：作業表的 `selected_modules` 欄位只記錄這 3 個模組的 ID，學生只需完成這 3 個即可。

---

## 問題 5：知識樹/課程結構設計

### 問題描述
課程需要有知識圖譜/知識樹展開，層次怎麼設計？

### 子問題 A：節點類型

**選項 1：課程本身就是節點**
**選項 2：知識點/能力是節點，課程掛在下面**
**選項 3：課程內容（生字、詞語）是節點**

### 決策 A：章節關係（可自由編排）✅

**特點**：
- 節點是課程的組織結構（類似 Notion 的 page hierarchy）
- 可以自由拖曳調整順序和層級
- 類似目錄、章節的概念

**範例**：
```
國小二年級國語
  ├─ 單元一：我的家人
  │    ├─ 第一課：我的家
  │    ├─ 第二課：爸爸媽媽
  │    └─ 單元測驗
  │
  ├─ 單元二：學校生活
  │    ├─ 第三課：上學去
  │    └─ 第四課：我的同學
  │
  └─ 期末總複習
```

---

### 子問題 B：層次關係

**選項 1：學習順序（prerequisite）**
**選項 2：分類階層（category）**
**選項 3：混合模式**

### 決策 B：學習順序 + 分類階層都支援 ✅

**特點**：
- 每個節點可以是「學習順序」或「分類階層」
- 由編輯自己決定
- 解鎖機制、遊戲化另外獨立功能（不綁在核心 schema）

**學習順序範例**：
```
注音符號基礎
  → 聲母練習（prerequisite）
    → 韻母練習（prerequisite）
      → 拼音練習
```

**分類階層範例**：
```
國小二年級國語（category）
  ├─ 單元一（category）
  ├─ 單元二（category）
  └─ 單元三（category）
```

**混合範例**：
```
國小一年級（category）
  └─ 注音符號（category）
       └─ ㄅ（prerequisite）
            → ㄆ（prerequisite）
              → ㄇ（prerequisite）
```

---

### 實作影響

**資料結構**：
- 需要 `course_nodes` 表記錄節點
- 需要 `parent_id` 支援樹狀結構
- 需要 `order` 欄位支援拖曳排序
- 需要 `node_type` 欄位（'category' | 'prerequisite'）
- 需要 `prerequisite_ids` 欄位記錄先修要求（JSONB）

**編輯器功能**：
- 拖曳排序（類似 Notion）
- 設定節點類型（分類 or 先修）
- 設定先修要求（可選）

**學生端功能**：
- 顯示課程樹狀結構
- 根據 `node_type` 決定是否需要解鎖
- 遊戲化機制獨立實作（如：星星、徽章、進度條）

---

## 變更記錄

| 日期 | 變更內容 | 變更者 |
|------|---------|--------|
| 2026-02-13 | 初版建立，記錄四個核心商業邏輯決策 | Young Tsai |
| 2026-02-13 | 新增問題 5：知識樹/課程結構設計決策 | Young Tsai |
| 2026-02-13 | **新增問題 0：平台架構層級設計** - 加入機構層級支援多租戶 SaaS 架構 | Young Tsai |

---

**文件用途**：
此文件作為教育平台架構設計的「憲法」，所有 schema 設計、API 設計、UI 設計都應該遵循這些商業邏輯決策。未來如有調整，需更新此文件並記錄變更理由。
